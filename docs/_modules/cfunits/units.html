
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>cfunits.units &#8212; Documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><b><a href="../../index.html">cfunits 3.2.3</a></b></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html"><strong>Installation</strong></a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cfunits.Units.html">cfunits.Units</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for cfunits.units</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span>      <span class="k">as</span> <span class="n">numpy_array</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">asanyarray</span> <span class="k">as</span> <span class="n">numpy_asanyarray</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">dtype</span>      <span class="k">as</span> <span class="n">numpy_dtype</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">generic</span>    <span class="k">as</span> <span class="n">numpy_generic</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ndarray</span>    <span class="k">as</span> <span class="n">numpy_ndarray</span>



<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># Aliases for ctypes</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="n">_sizeof_buffer</span> <span class="o">=</span> <span class="mi">257</span>
<span class="n">_string_buffer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="n">_sizeof_buffer</span><span class="p">)</span>
<span class="n">_c_char_p</span>      <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span>
<span class="n">_c_int</span>         <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span>
<span class="n">_c_uint</span>        <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span>
<span class="n">_c_float</span>       <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_float</span>
<span class="n">_c_double</span>      <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span>
<span class="n">_c_size_t</span>      <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_size_t</span>
<span class="n">_c_void_p</span>      <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span>
<span class="n">_pointer</span>       <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">pointer</span>
<span class="n">_POINTER</span>       <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span>

<span class="n">_ctypes_POINTER</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4</span><span class="p">:</span> <span class="n">_POINTER</span><span class="p">(</span><span class="n">_c_float</span><span class="p">),</span>
                   <span class="mi">8</span><span class="p">:</span> <span class="n">_POINTER</span><span class="p">(</span><span class="n">_c_double</span><span class="p">)}</span>

<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># Load the Udunits-2 library and read the database</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;darwin&#39;</span><span class="p">:</span>
    <span class="c1"># This has been tested on Mac OSX 10.5.8 and 10.6.8</span>
    <span class="n">_udunits</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s1">&#39;libudunits2.0.dylib&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Linux</span>
    <span class="n">_udunits</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s1">&#39;libudunits2.so.0&#39;</span><span class="p">)</span>

<span class="c1"># Suppress &quot;overrides prefixed-unit&quot; messages. This also suppresses</span>
<span class="c1"># all other error messages - so watch out!</span>
<span class="c1">#</span>
<span class="c1"># Messages may be turned back on by calling the module function</span>
<span class="c1"># udunits_error_messages.</span>
<span class="c1"># ut_error_message_handler ut_set_error_message_handler(</span>
<span class="c1">#                                   ut_error_message_handler handler);</span>
<span class="n">_ut_set_error_message_handler</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_set_error_message_handler</span>
<span class="n">_ut_set_error_message_handler</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="p">)</span>
<span class="n">_ut_set_error_message_handler</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="n">_ut_set_error_message_handler</span><span class="p">(</span><span class="n">_udunits</span><span class="o">.</span><span class="n">ut_ignore</span><span class="p">)</span>

<span class="c1"># Read the data base</span>
<span class="c1"># ut_system* ut_read_xml(const char* path);</span>
<span class="n">_ut_read_xml</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_read_xml</span>
<span class="n">_ut_read_xml</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_char_p</span><span class="p">,</span> <span class="p">)</span>
<span class="n">_ut_read_xml</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1">#print(&#39;units: before _udunits.ut_read_xml(&#39;,_unit_database,&#39;)&#39;)</span>
<span class="n">_ut_system</span> <span class="o">=</span> <span class="n">_ut_read_xml</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
<span class="c1">#print(&#39;units: after  _udunits.ut_read_xml(&#39;,_unit_database,&#39;)&#39;)</span>

<span class="c1"># Reinstate the reporting of error messages</span>
<span class="c1">#_ut_set_error_message_handler(_udunits.ut_write_to_stderr)</span>

<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># Aliases for the UDUNITS-2 C API. See</span>
<span class="c1"># http://www.unidata.ucar.edu/software/udunits/udunits-2.0.4/udunits2lib.html</span>
<span class="c1"># for documentation.</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># int ut_format(const ut_unit* const unit, char* buf, size_t size, unsigned opts);</span>
<span class="n">_ut_format</span>          <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_format</span>
<span class="n">_ut_format</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">,</span> <span class="n">_c_size_t</span><span class="p">,</span> <span class="n">_c_uint</span><span class="p">)</span>
<span class="n">_ut_format</span><span class="o">.</span><span class="n">restype</span>  <span class="o">=</span> <span class="n">_c_int</span>

<span class="c1"># char* ut_trim(char* const string, const ut_encoding encoding);</span>
<span class="n">_ut_trim</span>            <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_trim</span>
<span class="n">_ut_trim</span><span class="o">.</span><span class="n">argtypes</span>   <span class="o">=</span> <span class="p">(</span><span class="n">_c_char_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">)</span> <span class="c1"># ut_encoding assumed to be int!</span>
<span class="n">_ut_trim</span><span class="o">.</span><span class="n">restype</span>    <span class="o">=</span> <span class="n">_c_char_p</span>

<span class="c1"># ut_unit* ut_parse(const ut_system* const system,</span>
<span class="c1">#                   const char* const string, const ut_encoding encoding);</span>
<span class="n">_ut_parse</span>           <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_parse</span>
<span class="n">_ut_parse</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">)</span> <span class="c1"># ut_encoding assumed to be int!</span>
<span class="n">_ut_parse</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># int ut_compare(const ut_unit* const unit1, const ut_unit* const</span>
<span class="c1">#                unit2);</span>
<span class="n">_ut_compare</span>         <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_compare</span>
<span class="n">_ut_compare</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_compare</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_int</span>

<span class="c1"># int ut_are_convertible(const ut_unit* const unit1, const ut_unit*</span>
<span class="c1">#                        const unit2);</span>
<span class="n">_ut_are_convertible</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_are_convertible</span>
<span class="n">_ut_are_convertible</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_are_convertible</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_int</span>

<span class="c1"># cv_converter* ut_get_converter(ut_unit* const from, ut_unit* const</span>
<span class="c1">#                                to);</span>
<span class="n">_ut_get_converter</span>   <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_get_converter</span>
<span class="n">_ut_get_converter</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_get_converter</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># ut_unit* ut_divide(const ut_unit* const numer, const ut_unit* const</span>
<span class="c1">#                    denom);</span>
<span class="n">_ut_divide</span>          <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_divide</span>
<span class="n">_ut_divide</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_divide</span><span class="o">.</span><span class="n">restype</span>  <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># ut_unit* ut_offset(const ut_unit* const unit, const double offset);</span>
<span class="n">_ut_offset</span>          <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_offset</span>
<span class="n">_ut_offset</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_double</span><span class="p">)</span>
<span class="n">_ut_offset</span><span class="o">.</span><span class="n">restype</span>  <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># ut_unit* ut_raise(const ut_unit* const unit, const int power);</span>
<span class="n">_ut_raise</span>           <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_raise</span>
<span class="n">_ut_raise</span><span class="o">.</span><span class="n">argtypes</span>  <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">)</span>
<span class="n">_ut_raise</span><span class="o">.</span><span class="n">restype</span>   <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># ut_unit* ut_scale(const double factor, const ut_unit* const unit);</span>
<span class="n">_ut_scale</span>           <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_scale</span>
<span class="n">_ut_scale</span><span class="o">.</span><span class="n">argtypes</span>  <span class="o">=</span> <span class="p">(</span><span class="n">_c_double</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_scale</span><span class="o">.</span><span class="n">restype</span>   <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># ut_unit* ut_multiply(const ut_unit* const unit1, const ut_unit*</span>
<span class="c1">#                      const unit2);</span>
<span class="n">_ut_multiply</span>        <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_multiply</span>
<span class="n">_ut_multiply</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_multiply</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># ut_unit* ut_log(const double base, const ut_unit* const reference);</span>
<span class="n">_ut_log</span>             <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_log</span>
<span class="n">_ut_log</span><span class="o">.</span><span class="n">argtypes</span>    <span class="o">=</span> <span class="p">(</span><span class="n">_c_double</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_log</span><span class="o">.</span><span class="n">restype</span>     <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># ut_unit* ut_root(const ut_unit* const unit, const int root);</span>
<span class="n">_ut_root</span>            <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_root</span>
<span class="n">_ut_root</span><span class="o">.</span><span class="n">argtypes</span>   <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">)</span>
<span class="n">_ut_root</span><span class="o">.</span><span class="n">restype</span>    <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># void ut_free_system(ut_system*  system);</span>
<span class="n">_ut_free</span>            <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_free</span>
<span class="n">_ut_free</span><span class="o">.</span><span class="n">argypes</span>    <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="p">)</span>
<span class="n">_ut_free</span><span class="o">.</span><span class="n">restype</span>    <span class="o">=</span> <span class="bp">None</span>

<span class="c1"># float* cv_convert_floats(const cv_converter* converter, const float*</span>
<span class="c1">#                          const in, const size_t count, float* out);</span>
<span class="n">_cv_convert_floats</span>  <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">cv_convert_floats</span>
<span class="n">_cv_convert_floats</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_size_t</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_cv_convert_floats</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># double* cv_convert_doubles(const cv_converter* converter, const</span>
<span class="c1">#                            double* const in, const size_t count,</span>
<span class="c1">#                            double* out);</span>
<span class="n">_cv_convert_doubles</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">cv_convert_doubles</span>
<span class="n">_cv_convert_doubles</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_size_t</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_cv_convert_doubles</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># double cv_convert_double(const cv_converter* converter, const double</span>
<span class="c1">#                          value);</span>
<span class="n">_cv_convert_double</span>  <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">cv_convert_double</span>
<span class="n">_cv_convert_double</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_double</span><span class="p">)</span>
<span class="n">_cv_convert_double</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_double</span>

<span class="c1"># void cv_free(cv_converter* const conv);</span>
<span class="n">_cv_free</span>            <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">cv_free</span>
<span class="n">_cv_free</span><span class="o">.</span><span class="n">argtypes</span>   <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="p">)</span>
<span class="n">_cv_free</span><span class="o">.</span><span class="n">restype</span>    <span class="o">=</span> <span class="bp">None</span>

<span class="n">_UT_ASCII</span>      <span class="o">=</span> <span class="mi">0</span>
<span class="n">_UT_NAMES</span>      <span class="o">=</span> <span class="mi">4</span>
<span class="n">_UT_DEFINITION</span> <span class="o">=</span> <span class="mi">8</span>

<span class="n">_cv_convert_array</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4</span><span class="p">:</span> <span class="n">_cv_convert_floats</span><span class="p">,</span>
                     <span class="mi">8</span><span class="p">:</span> <span class="n">_cv_convert_doubles</span><span class="p">}</span>

<span class="c1"># Some function definitions necessary for the following</span>
<span class="c1"># changes to the unit system.</span>
<span class="n">_ut_get_unit_by_name</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_get_unit_by_name</span>
<span class="n">_ut_get_unit_by_name</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">)</span>
<span class="n">_ut_get_unit_by_name</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>
<span class="n">_ut_get_status</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_get_status</span>
<span class="n">_ut_get_status</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_int</span>
<span class="n">_ut_unmap_symbol_to_unit</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_unmap_symbol_to_unit</span>
<span class="n">_ut_unmap_symbol_to_unit</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">)</span>
<span class="n">_ut_unmap_symbol_to_unit</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_int</span>
<span class="n">_ut_map_symbol_to_unit</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_map_symbol_to_unit</span>
<span class="n">_ut_map_symbol_to_unit</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_char_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_map_symbol_to_unit</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_int</span>
<span class="n">_ut_map_unit_to_symbol</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_map_unit_to_symbol</span>
<span class="n">_ut_map_unit_to_symbol</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">)</span>
<span class="n">_ut_map_unit_to_symbol</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_int</span>
<span class="n">_ut_map_name_to_unit</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_map_name_to_unit</span>
<span class="n">_ut_map_name_to_unit</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_char_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">,</span> <span class="n">_c_void_p</span><span class="p">)</span>
<span class="n">_ut_map_name_to_unit</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_int</span>
<span class="n">_ut_map_unit_to_name</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_map_unit_to_name</span>
<span class="n">_ut_map_unit_to_name</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">)</span>
<span class="n">_ut_map_unit_to_name</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_int</span>
<span class="n">_ut_new_base_unit</span> <span class="o">=</span> <span class="n">_udunits</span><span class="o">.</span><span class="n">ut_new_base_unit</span>
<span class="n">_ut_new_base_unit</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">(</span><span class="n">_c_void_p</span><span class="p">,</span> <span class="p">)</span>
<span class="n">_ut_new_base_unit</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">_c_void_p</span>

<span class="c1"># Change Sv mapping. Both sievert and sverdrup are just aliases,</span>
<span class="c1"># so no unit to symbol mapping needs to be changed.</span>
<span class="c1"># We don&#39;t need to remove rem, since it was constructed with</span>
<span class="c1"># the correct sievert mapping in place; because that mapping</span>
<span class="c1"># was only an alias, the unit now doesn&#39;t depend on the mapping</span>
<span class="c1"># persisting.</span>
<span class="k">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">_ut_unmap_symbol_to_unit</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Sv&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">_ut_map_symbol_to_unit</span><span class="p">(</span><span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Sv&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">,</span>
                                   <span class="n">_ut_get_unit_by_name</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;sverdrup&#39;</span><span class="p">))))</span>
       
<span class="c1"># Add new base unit calendar_year</span>
<span class="n">calendar_year_unit</span> <span class="o">=</span> <span class="n">_ut_new_base_unit</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">_ut_map_symbol_to_unit</span><span class="p">(</span><span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;cY&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">,</span> <span class="n">calendar_year_unit</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">_ut_map_unit_to_symbol</span><span class="p">(</span><span class="n">calendar_year_unit</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;cY&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">_ut_map_name_to_unit</span><span class="p">(</span><span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;calendar_year&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">,</span> <span class="n">calendar_year_unit</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">_ut_map_unit_to_name</span><span class="p">(</span><span class="n">calendar_year_unit</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;calendar_year&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">))</span>
<span class="k">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">_ut_map_name_to_unit</span><span class="p">(</span><span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;calendar_years&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">,</span> <span class="n">calendar_year_unit</span><span class="p">))</span>

<span class="c1"># Add various aliases useful for CF</span>
<span class="k">def</span> <span class="nf">add_unit_alias</span><span class="p">(</span><span class="n">definition</span><span class="p">,</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">singular</span><span class="p">,</span> <span class="n">plural</span><span class="p">):</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="n">definition</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">symbol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">_ut_map_symbol_to_unit</span><span class="p">(</span><span class="n">_c_char_p</span><span class="p">(</span><span class="n">symbol</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span> <span class="n">_UT_ASCII</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">singular</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">_ut_map_name_to_unit</span><span class="p">(</span><span class="n">_c_char_p</span><span class="p">(</span><span class="n">singular</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span> <span class="n">_UT_ASCII</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">plural</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">assert</span><span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">_ut_map_name_to_unit</span><span class="p">(</span><span class="n">_c_char_p</span><span class="p">(</span><span class="n">plural</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span> <span class="n">_UT_ASCII</span><span class="p">,</span> <span class="n">unit</span><span class="p">))</span>

<span class="n">add_unit_alias</span><span class="p">(</span><span class="s2">&quot;1.e-3&quot;</span><span class="p">,</span> <span class="s2">&quot;psu&quot;</span><span class="p">,</span> <span class="s2">&quot;practical_salinity_unit&quot;</span><span class="p">,</span> <span class="s2">&quot;practical_salinity_units&quot;</span><span class="p">)</span>
<span class="n">add_unit_alias</span><span class="p">(</span><span class="s2">&quot;calendar_year/12&quot;</span><span class="p">,</span> <span class="s2">&quot;cM&quot;</span><span class="p">,</span> <span class="s2">&quot;calendar_month&quot;</span><span class="p">,</span> <span class="s2">&quot;calendar_months&quot;</span><span class="p">)</span>
<span class="n">add_unit_alias</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;level&quot;</span><span class="p">,</span> <span class="s2">&quot;levels&quot;</span><span class="p">)</span>
<span class="n">add_unit_alias</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;layer&quot;</span><span class="p">,</span> <span class="s2">&quot;layers&quot;</span><span class="p">)</span>
<span class="n">add_unit_alias</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;sigma_level&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma_levels&quot;</span><span class="p">)</span>
<span class="n">add_unit_alias</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;dB&quot;</span><span class="p">,</span> <span class="s2">&quot;decibel&quot;</span><span class="p">,</span> <span class="s2">&quot;debicels&quot;</span><span class="p">)</span>
<span class="n">add_unit_alias</span><span class="p">(</span><span class="s2">&quot;10 dB&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s2">&quot;bel&quot;</span><span class="p">,</span> <span class="s2">&quot;bels&quot;</span><span class="p">)</span>

<span class="c1">#_udunits.ut_get_unit_by_name(_udunits.ut_new_base_unit(_ut_system),</span>
<span class="c1">#                             _ut_system, &#39;calendar_year&#39;)</span>

<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># Create a calendar year unit</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1">#_udunits.ut_map_name_to_unit(&#39;calendar_year&#39;, _UT_ASCII,</span>
<span class="c1">#                             _udunits.ut_new_base_unit(_ut_system))</span>

<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># Aliases for netCDF4.netcdftime classes</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="kn">import</span> <span class="nn">cftime</span>    
<span class="c1">#_netCDF4_netcdftime_utime = cftime.utime</span>
<span class="n">_datetime</span>                 <span class="o">=</span> <span class="n">cftime</span><span class="o">.</span><span class="n">datetime</span>
    
<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># Aliases for netCDF4.netcdftime functions</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="n">_num2date</span> <span class="o">=</span> <span class="n">cftime</span><span class="o">.</span><span class="n">num2date</span>
<span class="n">_date2num</span> <span class="o">=</span> <span class="n">cftime</span><span class="o">.</span><span class="n">date2num</span>
    
<span class="n">_cached_ut_unit</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">_cached_utime</span>   <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># Save some useful units</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># A time ut_unit (equivalent to &#39;day&#39;, &#39;second&#39;, etc.)</span>
<span class="n">_day_ut_unit</span>  <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;day&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
<span class="n">_cached_ut_unit</span><span class="p">[</span><span class="s1">&#39;days&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_day_ut_unit</span>
<span class="c1"># A pressure ut_unit (equivalent to &#39;Pa&#39;, &#39;hPa&#39;, etc.)</span>
<span class="n">_pressure_ut_unit</span> <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;pascal&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
<span class="n">_cached_ut_unit</span><span class="p">[</span><span class="s1">&#39;pascal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_pressure_ut_unit</span>
<span class="c1"># A calendar time ut_unit (equivalent to &#39;cY&#39;, &#39;cM&#39;)</span>
<span class="n">_calendartime_ut_unit</span> <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;calendar_year&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
<span class="n">_cached_ut_unit</span><span class="p">[</span><span class="s1">&#39;calendar_year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_calendartime_ut_unit</span>
<span class="c1"># A dimensionless unit one (equivalent to &#39;&#39;, &#39;1&#39;, &#39;2&#39;, etc.)</span>
<span class="c1">#_dimensionless_unit_one = _udunits.ut_get_dimensionless_unit_one(_ut_system)</span>
<span class="c1">#_cached_ut_unit[&#39;&#39;]  = _dimensionless_unit_one</span>
<span class="c1">#_cached_ut_unit[&#39;1&#39;] = _dimensionless_unit_one</span>

<span class="n">_dimensionless_unit_one</span> <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;1&#39;</span><span class="p">),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
<span class="n">_cached_ut_unit</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">_dimensionless_unit_one</span>
<span class="n">_cached_ut_unit</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_dimensionless_unit_one</span>

<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># Set the default calendar type according to the CF conventions</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="n">_default_calendar</span> <span class="o">=</span> <span class="s1">&#39;gregorian&#39;</span>
<span class="n">_canonical_calendar</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;gregorian&#39;</span>          <span class="p">:</span> <span class="s1">&#39;gregorian&#39;</span>          <span class="p">,</span>
                       <span class="s1">&#39;standard&#39;</span>           <span class="p">:</span> <span class="s1">&#39;gregorian&#39;</span>          <span class="p">,</span>
                       <span class="s1">&#39;none&#39;</span>               <span class="p">:</span> <span class="s1">&#39;gregorian&#39;</span>          <span class="p">,</span>
                       <span class="s1">&#39;proleptic_gregorian&#39;</span><span class="p">:</span> <span class="s1">&#39;proleptic_gregorian&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;360_day&#39;</span>            <span class="p">:</span> <span class="s1">&#39;360_day&#39;</span>            <span class="p">,</span>
                       <span class="s1">&#39;noleap&#39;</span>             <span class="p">:</span> <span class="s1">&#39;365_day&#39;</span>            <span class="p">,</span>
                       <span class="s1">&#39;365_day&#39;</span>            <span class="p">:</span> <span class="s1">&#39;365_day&#39;</span>            <span class="p">,</span>
                       <span class="s1">&#39;all_leap&#39;</span>           <span class="p">:</span> <span class="s1">&#39;366_day&#39;</span>            <span class="p">,</span>
                       <span class="s1">&#39;366_day&#39;</span>            <span class="p">:</span> <span class="s1">&#39;366_day&#39;</span>            <span class="p">,</span>
                       <span class="s1">&#39;julian&#39;</span>             <span class="p">:</span> <span class="s1">&#39;julian&#39;</span>             <span class="p">,</span>
                       <span class="p">}</span>

<span class="n">_months_or_years</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;months&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;years&#39;</span><span class="p">,</span> <span class="s1">&#39;yr&#39;</span><span class="p">)</span>

<span class="c1">## --------------------------------------------------------------------</span>
<span class="c1">## Set month lengths in days for non-leap years (_days_in_month[0,1:])</span>
<span class="c1">## and leap years (_days_in_month[1,1:])</span>
<span class="c1">## --------------------------------------------------------------------</span>
<span class="c1">#_days_in_month = numpy_array(</span>
<span class="c1">#    [[-99, 31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],</span>
<span class="c1">#     [-99, 31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]])</span>

<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># Function to control Udunits error messages</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">udunits_error_messages</span><span class="p">(</span><span class="n">flag</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Control the printing of error messages from Udunits, which are</span>
<span class="sd">    turned off by default.</span>
<span class="sd">    </span>
<span class="sd">    :Parameters:</span>
<span class="sd">    </span>
<span class="sd">        flag: `bool`</span>
<span class="sd">            Set to True to print Udunits error messages and False to</span>
<span class="sd">            not print Udunits error messages.</span>
<span class="sd">    </span>
<span class="sd">    :Returns:</span>
<span class="sd">    </span>
<span class="sd">        `None`</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; udunits_error_messages(True)</span>
<span class="sd">    &gt;&gt;&gt; udunits_error_messages(False)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">flag</span><span class="p">:</span>
        <span class="n">_ut_set_error_message_handler</span><span class="p">(</span><span class="n">_udunits</span><span class="o">.</span><span class="n">ut_write_to_stderr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">_ut_set_error_message_handler</span><span class="p">(</span><span class="n">_udunits</span><span class="o">.</span><span class="n">ut_ignore</span><span class="p">)</span>


<span class="c1">#def _month_length(year, month, calendar, _days_in_month=_days_in_month):</span>
<span class="c1">#    &#39;&#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#Find month lengths in days for each year/month pairing in the input</span>
<span class="c1">#numpy arrays &#39;year&#39; and &#39;month&#39;, both of which must have the same</span>
<span class="c1">#shape. &#39;calendar&#39; must be one of the standard CF calendar types.</span>
<span class="c1">#</span>
<span class="c1">#:Parameters:</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#&#39;&#39;&#39;</span>
<span class="c1">#    shape = month.shape</span>
<span class="c1">#    if calendar in (&#39;standard&#39;, &#39;gregorian&#39;):</span>
<span class="c1">#        leap = numpy_where(year % 4 == 0, 1, 0)</span>
<span class="c1">#        leap = numpy_where((year &gt; 1582) &amp;</span>
<span class="c1">#                           (year % 100 == 0) &amp; (year % 400 != 0),</span>
<span class="c1">#                           0, leap)</span>
<span class="c1">#    elif calendar == &#39;360_day&#39;:</span>
<span class="c1">#        days_in_month = numpy_empty(shape)</span>
<span class="c1">#        days_in_month.fill(30)</span>
<span class="c1">#        return days_in_month</span>
<span class="c1">#</span>
<span class="c1">#    elif calendar in (&#39;all_leap&#39;, &#39;366_day&#39;):</span>
<span class="c1">#        leap = numpy_zeros(shape)</span>
<span class="c1">#</span>
<span class="c1">#    elif calendar in (&#39;no_leap&#39;, &#39;365_day&#39;):</span>
<span class="c1">#        leap = numpy_ones(shape)</span>
<span class="c1">#</span>
<span class="c1">#    elif calendar == &#39;proleptic_gregorian&#39;:</span>
<span class="c1">#        leap = numpy_where(year % 4 == 0, 1, 0)</span>
<span class="c1">#        leap = numpy_where((year % 100 == 0) &amp; (year % 400 != 0),</span>
<span class="c1">#                           0, leap)</span>
<span class="c1">#</span>
<span class="c1">#    days_in_month = numpy_array([_days_in_month[l, m]</span>
<span class="c1">#                                 for l, m in zip(leap.flat, month.flat)])</span>
<span class="c1">#    days_in_month.resize(shape)</span>
<span class="c1">#</span>
<span class="c1">#    return days_in_month</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#def _proper_date(year, month, day, calendar, fix=False,</span>
<span class="c1">#                 _days_in_month=_days_in_month):</span>
<span class="c1">#    &#39;&#39;&#39;</span>
<span class="c1">#</span>
<span class="c1">#Given equally shaped numpy arrays of &#39;year&#39;, &#39;month&#39;, &#39;day&#39; adjust</span>
<span class="c1">#them *in place* to be proper dates. &#39;calendar&#39; must be one of the</span>
<span class="c1">#standard CF calendar types.</span>
<span class="c1">#</span>
<span class="c1">#Excessive number of months are converted to years but excessive days</span>
<span class="c1">#are not converted to months nor years. If a day is illegal in the</span>
<span class="c1">#proper date then a ValueError is raised, unless &#39;fix&#39; is True, in</span>
<span class="c1">#which case the day is lowered to the nearest legal date:</span>
<span class="c1">#</span>
<span class="c1">#    2000/26/1 -&gt; 2002/3/1</span>
<span class="c1">#</span>
<span class="c1">#    2001/2/31 -&gt; ValueError if &#39;fix&#39; is False</span>
<span class="c1">#    2001/2/31 -&gt; 2001/2/28  if &#39;fix&#39; is True</span>
<span class="c1">#    2001/2/99 -&gt; 2001/2/28  if &#39;fix&#39; is True</span>
<span class="c1">#</span>
<span class="c1">#:Parameters:</span>
<span class="c1">#</span>
<span class="c1">#&#39;&#39;&#39;</span>
<span class="c1">##    y, month = divmod(month, 12)</span>
<span class="c1">##    year += y</span>
<span class="c1">#</span>
<span class="c1">#    year      += month // 12</span>
<span class="c1">#    month[...] = month % 12</span>
<span class="c1">#</span>
<span class="c1">#    mask       = (month == 0)</span>
<span class="c1">#    year[...]  = numpy_where(mask, year-1, year)</span>
<span class="c1">#    month[...] = numpy_where(mask, 12, month)</span>
<span class="c1">#    del mask</span>
<span class="c1">#</span>
<span class="c1">#    days_in_month = _month_length(year, month, calendar,</span>
<span class="c1">#                                  _days_in_month=_days_in_month)</span>
<span class="c1">#</span>
<span class="c1">#    if fix:</span>
<span class="c1">#        day[...] = numpy_where(day &gt; days_in_month, days_in_month, day)</span>
<span class="c1">#    elif (day &gt; days_in_month).any():</span>
<span class="c1">#        raise ValueError(&quot;Illegal date(s) in %s calendar&quot; % calendar)</span>
<span class="c1">#</span>
<span class="c1">#    return year, month, day</span>


<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># Constants, as defined by UDUNITS</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="n">_year_length</span> <span class="o">=</span> <span class="mf">365.242198781</span>
<span class="n">_month_length</span> <span class="o">=</span> <span class="n">_year_length</span> <span class="o">/</span> <span class="mi">12</span>
    

<div class="viewcode-block" id="Units"><a class="viewcode-back" href="../../cfunits.Units.html#cfunits.Units">[docs]</a><span class="k">class</span> <span class="nc">Units</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Store, combine and compare physical units and convert numeric values</span>
<span class="sd">to different units.</span>

<span class="sd">Units are as defined in UNIDATA&#39;s Udunits-2 package, with a few</span>
<span class="sd">exceptions for greater consistency with the CF conventions namely</span>
<span class="sd">support for CF calendars and new units definitions.</span>


<span class="sd">**Modifications to the standard Udunits database**</span>

<span class="sd">Whilst a standard Udunits-2 database may be used, greater consistency</span>
<span class="sd">with CF is achieved by using a modified database. The following units</span>
<span class="sd">are either new to, modified from, or removed from the standard</span>
<span class="sd">Udunits-2 database (version 2.1.24):</span>

<span class="sd">=======================  ======  ============  ==============</span>
<span class="sd">Unit name                Symbol  Definition    Status</span>
<span class="sd">=======================  ======  ============  ==============</span>
<span class="sd">practical_salinity_unit  psu     1e-3          New unit</span>
<span class="sd">level                            1             New unit</span>
<span class="sd">sigma_level                      1             New unit</span>
<span class="sd">layer                            1             New unit</span>
<span class="sd">decibel                  dB      1             New unit</span>
<span class="sd">bel                              10 dB         New unit</span>
<span class="sd">sverdrup                 Sv      1e6 m3 s-1    Added symbol</span>
<span class="sd">sievert                          J kg-1        Removed symbol</span>
<span class="sd">=======================  ======  ============  ==============</span>

<span class="sd">Plural forms of the new units&#39; names are allowed, such as</span>
<span class="sd">``practical_salinity_units``.</span>

<span class="sd">The modified database is in the *udunits* subdirectory of the *etc*</span>
<span class="sd">directory found in the same location as this module.</span>


<span class="sd">**Accessing units**</span>

<span class="sd">Units may be set, retrieved and deleted via the `units` attribute. Its</span>
<span class="sd">value is a string that can be recognized by UNIDATA&#39;s Udunits-2</span>
<span class="sd">package, with the few exceptions given in the CF conventions.</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;m s-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; u</span>
<span class="sd">&lt;Cf Units: &#39;m s-1&#39;&gt;</span>
<span class="sd">&gt;&gt;&gt; u.units = &#39;days since 2004-3-1&#39;</span>
<span class="sd">&gt;&gt;&gt; u</span>
<span class="sd">&lt;Units: days since 2004-3-1&gt;</span>


<span class="sd">**Equality and equivalence of units**</span>

<span class="sd">There are methods for assessing whether two units are equivalent or</span>
<span class="sd">equal. Two units are equivalent if numeric values in one unit are</span>
<span class="sd">convertible to numeric values in the other unit (such as</span>
<span class="sd">``kilometres`` and ``metres``). Two units are equal if they are</span>
<span class="sd">equivalent and their conversion is a scale factor of 1 and an offset</span>
<span class="sd">of 0 (such as ``kilometres`` and ``1000 metres``). Note that</span>
<span class="sd">equivalence and equality are based on internally stored binary</span>
<span class="sd">representations of the units, rather than their string</span>
<span class="sd">representations.</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;m/s&#39;)</span>
<span class="sd">&gt;&gt;&gt; v = Units(&#39;m s-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; w = Units(&#39;km.s-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; x = Units(&#39;0.001 kilometer.second-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; y = Units(&#39;gram&#39;)</span>

<span class="sd">&gt;&gt;&gt; u.equivalent(v), u.equals(v),  u == v</span>
<span class="sd">(True, True, True)</span>
<span class="sd">&gt;&gt;&gt; u.equivalent(w), u.equals(w)</span>
<span class="sd">(True, False)</span>
<span class="sd">&gt;&gt;&gt; u.equivalent(x), u.equals(x)</span>
<span class="sd">(True, True)</span>
<span class="sd">&gt;&gt;&gt; u.equivalent(y), u.equals(y)</span>
<span class="sd">(False, False)</span>


<span class="sd">**Time and reference time units**</span>

<span class="sd">Time units may be given as durations of time (*time units*) or as an</span>
<span class="sd">amount of time since a reference time (*reference time units*):</span>

<span class="sd">&gt;&gt;&gt; v = Units()</span>
<span class="sd">&gt;&gt;&gt; v.units = &#39;s&#39;</span>
<span class="sd">&gt;&gt;&gt; v.units = &#39;day&#39;</span>
<span class="sd">&gt;&gt;&gt; v.units = &#39;days since 1970-01-01&#39;</span>
<span class="sd">&gt;&gt;&gt; v.units = &#39;seconds since 1992-10-8 15:15:42.5 -6:00&#39;</span>

<span class="sd">.. note::</span>

<span class="sd">   It is recommended that the units ``year`` and ``month`` be used</span>
<span class="sd">   with caution, as explained in the following excerpt from the CF</span>
<span class="sd">   conventions: &quot;The Udunits package defines a year to be exactly</span>
<span class="sd">   365.242198781 days (the interval between 2 successive passages of</span>
<span class="sd">   the sun through vernal equinox). It is not a calendar year. Udunits</span>
<span class="sd">   includes the following definitions for years: a common_year is 365</span>
<span class="sd">   days, a leap_year is 366 days, a Julian_year is 365.25 days, and a</span>
<span class="sd">   Gregorian_year is 365.2425 days. For similar reasons the unit</span>
<span class="sd">   ``month``, which is defined to be exactly year/12, should also be</span>
<span class="sd">   used with caution.&quot;</span>

<span class="sd">**Calendar**</span>

<span class="sd">The date given in reference time units is associated with one of the</span>
<span class="sd">calendars recognized by the CF conventions and may be set with the</span>
<span class="sd">`calendar` attribute. However, as in the CF conventions, if the</span>
<span class="sd">calendar is not set then, for the purposes of calculation and</span>
<span class="sd">comparison, it defaults to the mixed Gregorian/Julian calendar as</span>
<span class="sd">defined by Udunits:</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;days since 2000-1-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; u.calendar</span>
<span class="sd">AttributeError: Can&#39;t get &#39;Units&#39; attribute &#39;calendar&#39;</span>
<span class="sd">&gt;&gt;&gt; v = Units(&#39;days since 2000-1-1&#39;)</span>
<span class="sd">&gt;&gt;&gt; v.calendar = &#39;gregorian&#39;</span>
<span class="sd">&gt;&gt;&gt; v.equals(u)</span>
<span class="sd">True</span>


<span class="sd">**Arithmetic with units**</span>

<span class="sd">The following operators, operations and assignments are overloaded:</span>

<span class="sd">Comparison operators:</span>

<span class="sd">    ``==, !=``</span>

<span class="sd">Binary arithmetic operations:</span>

<span class="sd">    ``+, -, *, /, pow(), **``</span>

<span class="sd">Unary arithmetic operations:</span>

<span class="sd">    ``-, +``</span>

<span class="sd">Augmented arithmetic assignments:</span>

<span class="sd">    ``+=, -=, *=, /=, **=``</span>

<span class="sd">The comparison operations return a boolean and all other operations</span>
<span class="sd">return a new units object or modify the units object in place.</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;m&#39;)</span>
<span class="sd">&lt;Units: m&gt;</span>

<span class="sd">&gt;&gt;&gt; v = u * 1000</span>
<span class="sd">&gt;&gt;&gt; v</span>
<span class="sd">&lt;Units: 1000 m&gt;</span>

<span class="sd">&gt;&gt;&gt; u == v</span>
<span class="sd">False</span>
<span class="sd">&gt;&gt;&gt; u != v</span>
<span class="sd">True</span>

<span class="sd">&gt;&gt;&gt; u **= 2</span>
<span class="sd">&gt;&gt;&gt; u</span>
<span class="sd">&lt;Units: m2&gt;</span>

<span class="sd">It is also possible to create the logarithm of a unit corresponding to</span>
<span class="sd">the given logarithmic base:</span>

<span class="sd">&gt;&gt;&gt; u = Units(&#39;seconds&#39;)</span>
<span class="sd">&gt;&gt;&gt; u.log(10)</span>
<span class="sd">&lt;Units: lg(re 1 s)&gt;</span>


<span class="sd">**Modifying data for equivalent units**</span>

<span class="sd">Any numpy array or python numeric type may be modified for equivalent</span>
<span class="sd">units using the `conform` static method.</span>

<span class="sd">&gt;&gt;&gt; Units.conform(2, Units(&#39;km&#39;), Units(&#39;m&#39;))</span>
<span class="sd">2000.0</span>

<span class="sd">&gt;&gt;&gt; import numpy</span>
<span class="sd">&gt;&gt;&gt; a = numpy.arange(5.0)</span>
<span class="sd">&gt;&gt;&gt; Units.conform(a, Units(&#39;minute&#39;), Units(&#39;second&#39;))</span>
<span class="sd">array([   0.,   60.,  120.,  180.,  240.])</span>
<span class="sd">&gt;&gt;&gt; a</span>
<span class="sd">array([ 0.,  1.,  2.,  3.,  4.])</span>

<span class="sd">If the *inplace* keyword is True, then a numpy array is modified in</span>
<span class="sd">place, without any copying overheads:</span>

<span class="sd">&gt;&gt;&gt; Units.conform(a,</span>
<span class="sd">                  Units(&#39;days since 2000-12-1&#39;),</span>
<span class="sd">                  Units(&#39;days since 2001-1-1&#39;), inplace=True)</span>
<span class="sd">array([-31., -30., -29., -28., -27.])</span>
<span class="sd">&gt;&gt;&gt; a</span>
<span class="sd">array([-31., -30., -29., -28., -27.])</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">formatted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">names</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">definition</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">_ut_unit</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;**Initialization**</span>

<span class="sd">    :Parameters:</span>
<span class="sd">    </span>
<span class="sd">        units: `str` or `Units`, optional</span>
<span class="sd">            Set the new units from this string.</span>
<span class="sd">    </span>
<span class="sd">        calendar: `str`, optional</span>
<span class="sd">            Set the calendar for reference time units.</span>
<span class="sd">    </span>
<span class="sd">        formatted: `bool`, optional</span>
<span class="sd">            Format the string representation of the units in a</span>
<span class="sd">            standardized manner. See the `formatted` method.</span>
<span class="sd">    </span>
<span class="sd">        names: `bool`, optional</span>
<span class="sd">            Format the string representation of the units using names</span>
<span class="sd">            instead of symbols. See the `format` method.</span>
<span class="sd">    </span>
<span class="sd">        definition: `bool`, optional</span>
<span class="sd">            Format the string representation of the units using basic</span>
<span class="sd">            units. See the `format` method.</span>
<span class="sd">    </span>
<span class="sd">        _ut_unit: `int`, optional</span>
<span class="sd">            Set the new units from this Udunits binary unit</span>
<span class="sd">            representation. This should be an integer returned by a</span>
<span class="sd">            call to `ut_parse` function of Udunits. Ignored if `units`</span>
<span class="sd">            is set.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="vm">__dict__</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_isvalid</span>             <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reason_notvalid</span>     <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>               <span class="o">=</span> <span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>             <span class="o">=</span> <span class="bp">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span>           <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>            <span class="o">=</span> <span class="n">calendar</span>       
        <span class="bp">self</span><span class="o">.</span><span class="n">_canonical_calendar</span>  <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>               <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units_since_reftime</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c1"># Set the calendar</span>
        <span class="n">_calendar</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">calendar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">_calendar</span> <span class="o">=</span> <span class="n">_canonical_calendar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">calendar</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">_calendar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_new_reason_notvalid</span><span class="p">(</span><span class="s1">&#39;Invalid calendar={!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calendar</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_isvalid</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">_calendar</span> <span class="o">=</span> <span class="n">calendar</span>
        <span class="c1">#--- End: if</span>

<span class="c1">#        if units is not None:</span>
<span class="c1">#            try:</span>
<span class="c1">#                units = units.strip()</span>
<span class="c1">#            except AttributeError as error:</span>
<span class="c1">#                print(units)</span>
<span class="c1">#                self._isvalid = False</span>
<span class="c1">#                self._reason_notvalid = self._reason_notvalid + &#39;; &#39;+str(error)</span>
<span class="c1">#        #--- End: if</span>
        
        <span class="k">if</span> <span class="n">units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_isvalid</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_new_reason_notvalid</span><span class="p">(</span><span class="s2">&quot;Bad units type: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">units</span><span class="p">)))</span>
                <span class="k">return</span>
<span class="c1">#                raise ValueError(&quot;Can&#39;t set unsupported unit: {!r}&quot;.format(units))</span>
           
            <span class="n">unit</span> <span class="o">=</span> <span class="bp">None</span>
            
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39; since &#39;</span> <span class="ow">in</span> <span class="n">units</span><span class="p">:</span>
                <span class="c1"># --------------------------------------------------------</span>
                <span class="c1"># Set a reference time unit</span>
                <span class="c1"># --------------------------------------------------------</span>
                <span class="c1"># Set the calendar</span>
                <span class="k">if</span> <span class="n">calendar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">_calendar</span> <span class="o">=</span> <span class="n">_default_calendar</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_calendar</span> <span class="o">=</span> <span class="n">_canonical_calendar</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">calendar</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">_calendar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">_calendar</span> <span class="o">=</span> <span class="n">calendar</span>
                <span class="c1">#--- End: if</span>
                        
                <span class="n">units_split</span> <span class="o">=</span> <span class="n">units</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; since &#39;</span><span class="p">)</span>
                <span class="n">unit</span>        <span class="o">=</span> <span class="n">units_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="n">_units_since_reftime</span> <span class="o">=</span> <span class="n">unit</span>
                
                <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_cached_ut_unit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>                    
                    <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="n">unit</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut_unit</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">_ut_are_convertible</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_day_ut_unit</span><span class="p">):</span>
                        <span class="n">ut_unit</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_isvalid</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_cached_ut_unit</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut_unit</span>
                <span class="c1">#--- End: if</span>
                
                <span class="n">utime</span> <span class="o">=</span> <span class="bp">None</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">units</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_cached_utime</span><span class="p">:</span>
                    <span class="n">utime</span> <span class="o">=</span> <span class="n">_cached_utime</span><span class="p">[(</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">units</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Create a new Utime object</span>
                    <span class="n">unit_string</span> <span class="o">=</span> <span class="s1">&#39;{} since {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">units_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

                    <span class="k">if</span> <span class="p">(</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">unit_string</span><span class="p">)</span> <span class="ow">in</span> <span class="n">_cached_utime</span><span class="p">:</span>
                        <span class="n">utime</span> <span class="o">=</span> <span class="n">_cached_utime</span><span class="p">[(</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">unit_string</span><span class="p">)]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">utime</span> <span class="o">=</span> <span class="n">Utime</span><span class="p">(</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">unit_string</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                            <span class="n">utime</span> <span class="o">=</span> <span class="bp">None</span>
                            <span class="k">if</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">_months_or_years</span><span class="p">:</span> <span class="c1">#(&#39;month&#39;, &#39;months&#39;, &#39;year&#39;, &#39;years&#39;, &#39;yr&#39;):</span>
                                <span class="n">temp_unit_string</span> <span class="o">=</span> <span class="s1">&#39;days since {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units_split</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">_</span> <span class="o">=</span> <span class="n">Utime</span><span class="p">(</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">temp_unit_string</span><span class="p">)</span>
                                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_new_reason_notvalid</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_isvalid</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_new_reason_notvalid</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">error</span><span class="p">))</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_isvalid</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="c1">#--- End: try</span>
                        
                        <span class="n">_cached_utime</span><span class="p">[(</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">unit_string</span><span class="p">)]</span> <span class="o">=</span> <span class="n">utime</span>
                <span class="c1">#--- End: if</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>  <span class="o">=</span> <span class="n">calendar</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_canonical_calendar</span> <span class="o">=</span> <span class="n">_calendar</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>     <span class="o">=</span> <span class="n">utime</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># ----------------------------------------------------</span>
                <span class="c1"># Set a unit other than a reference time unit</span>
                <span class="c1"># ----------------------------------------------------</span>
                <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_cached_ut_unit</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_ut_parse</span><span class="p">(</span><span class="n">_ut_system</span><span class="p">,</span> <span class="n">_c_char_p</span><span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span> <span class="n">_UT_ASCII</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ut_unit</span><span class="p">:</span>
                        <span class="n">ut_unit</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_isvalid</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_new_reason_notvalid</span><span class="p">(</span><span class="s2">&quot;Invalid units: {!r}; Not recognised by UDUNITS&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">units</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_cached_ut_unit</span><span class="p">[</span><span class="n">units</span><span class="p">]</span> <span class="o">=</span> <span class="n">ut_unit</span>
                <span class="c1">#--- End: if</span>
 
<span class="c1">#                if ut_unit is None:</span>
<span class="c1">#                    ut_unit = _ut_parse(_ut_system, _c_char_p(units.encode(&#39;utf-8&#39;)), _UT_ASCII)</span>
<span class="c1">#                    if not ut_unit:</span>
<span class="c1">#                        raise ValueError(</span>
<span class="c1">#                            &quot;Can&#39;t set unsupported unit: %r&quot; % units)</span>
<span class="c1">#                    _cached_ut_unit[units] = ut_unit</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>  <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_canonial_calendar</span>  <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>     <span class="o">=</span> <span class="bp">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span> <span class="o">=</span> <span class="n">ut_unit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>   <span class="o">=</span> <span class="n">units</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_units_since_reftime</span> <span class="o">=</span> <span class="n">unit</span>

            <span class="k">if</span> <span class="n">formatted</span> <span class="ow">or</span> <span class="n">names</span> <span class="ow">or</span> <span class="n">definition</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatted</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>

            <span class="k">return</span>

        <span class="k">elif</span> <span class="n">calendar</span><span class="p">:</span>
            <span class="c1">#---------------------------------------------------------</span>
            <span class="c1"># Calendar is set, but units are not.</span>
            <span class="c1">#---------------------------------------------------------</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>     <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>   <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>  <span class="o">=</span> <span class="n">calendar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_canonical_calendar</span> <span class="o">=</span> <span class="n">_canonical_calendar</span><span class="p">[</span><span class="n">calendar</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_units_since_reftime</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span> <span class="o">=</span> <span class="n">Utime</span><span class="p">(</span><span class="n">_canonical_calendar</span><span class="p">[</span><span class="n">calendar</span><span class="o">.</span><span class="n">lower</span><span class="p">()])</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_new_reason_notvalid</span><span class="p">(</span><span class="s1">&#39;Invalid calendar={!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">calendar</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_isvalid</span> <span class="o">=</span> <span class="bp">True</span>
                
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">_ut_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1">#---------------------------------------------------------</span>
            <span class="c1"># _ut_unit is set</span>
            <span class="c1">#---------------------------------------------------------</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span> <span class="o">=</span> <span class="n">_ut_unit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatted</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">definition</span><span class="p">)</span>
            <span class="n">_cached_ut_unit</span><span class="p">[</span><span class="n">units</span><span class="p">]</span> <span class="o">=</span> <span class="n">_ut_unit</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">=</span> <span class="n">units</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_units_since_reftime</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>  <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>     <span class="o">=</span> <span class="bp">None</span>


            <span class="k">return</span>

        <span class="c1">#-------------------------------------------------------------</span>
        <span class="c1"># Nothing has been set</span>
        <span class="c1">#-------------------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>               <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>             <span class="o">=</span> <span class="bp">None</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span>           <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>            <span class="o">=</span> <span class="bp">None</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_canonical_calendar</span>  <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>               <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_units_since_reftime</span> <span class="o">=</span> <span class="bp">None</span>


    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called when pickling.</span>

<span class="sd">    :Returns:</span>
<span class="sd">    </span>
<span class="sd">        `dict`</span>
<span class="sd">            A dictionary of the instance&#39;s attributes</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;days since 3-4-5&#39;, calendar=&#39;gregorian&#39;)</span>
<span class="sd">    &gt;&gt;&gt; u.__getstate__()</span>
<span class="sd">    {&#39;calendar&#39;: &#39;gregorian&#39;,</span>
<span class="sd">     &#39;units&#39;: &#39;days since 3-4-5&#39;}</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">attr</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>
                     <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;_units&#39;</span><span class="p">,</span> <span class="s1">&#39;_calendar&#39;</span><span class="p">)</span>
                     <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)])</span>


    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">odict</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called when unpickling.</span>

<span class="sd">    :Parameters:</span>
<span class="sd">    </span>
<span class="sd">        odict: `dict`</span>
<span class="sd">            The output from the instance&#39;s `__getstate__` method.</span>
<span class="sd">    </span>
<span class="sd">    :Returns:</span>
<span class="sd">    </span>
<span class="sd">        `None`</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">units</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s1">&#39;_units&#39;</span> <span class="ow">in</span> <span class="n">odict</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">odict</span><span class="p">[</span><span class="s1">&#39;_units&#39;</span><span class="p">]</span>

        <span class="n">calendar</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="s1">&#39;_calendar&#39;</span> <span class="ow">in</span> <span class="n">odict</span><span class="p">:</span>
            <span class="n">calendar</span> <span class="o">=</span> <span class="n">odict</span><span class="p">[</span><span class="s1">&#39;_calendar&#39;</span><span class="p">]</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="n">units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
            

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__hash__() &lt;==&gt; hash(x)</span>

<span class="sd">        &#39;&#39;&#39;</span>
<span class="c1">#        if not self:</span>
<span class="c1">#            return hash(self.__class__)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">))</span>

<span class="c1">#        return hash((self._ut_unit, self._rtime._jd0, self._rtime.calendar,</span>
<span class="c1">#                     self._rtime.tzoffset))</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="s1">&#39;Units&#39;</span><span class="p">,</span> 
                     <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rtime_jd0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rtime_calendar</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">_rtime_tzoffset</span><span class="p">))</span>

    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__repr__() &lt;==&gt; repr(x)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;{0}: {1}&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__str__() &lt;==&gt; str(x)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">string</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">string</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&#39;\&#39;</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">string</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_units</span><span class="p">))</span>
        <span class="c1">#--- End: if</span>
                              
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">string</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span><span class="p">))</span>

        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Used if copy.deepcopy is called on the variable.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Truth value testing and the built-in operation ``bool``</span>

<span class="sd">    x.__bool__() &lt;==&gt; x!=0</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>


    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The rich comparison operator ``==``</span>

<span class="sd">    x.__eq__(y) &lt;==&gt; x==y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The rich comparison operator ``!=``</span>

<span class="sd">    x.__ne__(y) &lt;==&gt; x!=y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The rich comparison operator ``&gt;``</span>

<span class="sd">    x.__gt__(y) &lt;==&gt; x&gt;y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparison</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__gt__&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The rich comparison operator ````</span>

<span class="sd">    x.__ge__(y) &lt;==&gt; x&gt;y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparison</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__ge__&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The rich comparison operator ````</span>

<span class="sd">    x.__lt__(y) &lt;==&gt; x&lt;y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparison</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__lt__&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The rich comparison operator ````</span>

<span class="sd">    x.__le__(y) &lt;==&gt; x&lt;=y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_comparison</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;__le__&#39;</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The binary arithmetic operation ``-``</span>

<span class="sd">    x.__sub__(y) &lt;==&gt; x-y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="ow">or</span>
            <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> - </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_ut_unit</span> <span class="o">=</span> <span class="n">_ut_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">_c_double</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">_ut_unit</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> - </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>


    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The binary arithmetic operation ``+``</span>

<span class="sd">    x.__add__(y) &lt;==&gt; x+y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="ow">or</span>
            <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> + </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_ut_unit</span> <span class="o">=</span> <span class="n">_ut_offset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">_c_double</span><span class="p">(</span><span class="o">-</span><span class="n">other</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">_ut_unit</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> + </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>


    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The binary arithmetic operation ``*``</span>

<span class="sd">    x.__mul__(y) &lt;==&gt; x*y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> * </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">ut_unit</span><span class="o">=</span><span class="n">_ut_multiply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> * </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>   
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> * </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">ut_unit</span><span class="o">=</span><span class="n">_ut_scale</span><span class="p">(</span><span class="n">_c_double</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">)</span>    
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> * </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="c1">#--- End: if</span>

        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">ut_unit</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__div__(y) &lt;==&gt; x/y</span>

<span class="sd">        &#39;&#39;&#39;</span> 
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> / </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">ut_unit</span><span class="o">=</span><span class="n">_ut_divide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> / </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> / </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">ut_unit</span><span class="o">=</span><span class="n">_ut_scale</span><span class="p">(</span><span class="n">_c_double</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">other</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> / </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
        <span class="c1">#--- End: if</span>

        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">ut_unit</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">modulo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The binary arithmetic operations ``**`` and ``pow``</span>

<span class="sd">    x.__pow__(y) &lt;==&gt; x**y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># ------------------------------------------------------------</span>
        <span class="c1"># y must be either an integer or the reciprocal of a positive</span>
        <span class="c1"># integer.</span>
        <span class="c1"># ------------------------------------------------------------</span>

        <span class="k">if</span> <span class="n">modulo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="s2">&quot;3-argument power not supported for </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
            <span class="n">ut_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">_ut_raise</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">other</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># If other is a float and (1/other) is a positive</span>
                <span class="c1"># integer then take the (1/other)-th root. E.g. if</span>
                <span class="c1"># other is 0.125 then we take the 8-th root.</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">recip_other</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">other</span>
                    <span class="n">root</span>        <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">recip_other</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">recip_other</span> <span class="o">==</span> <span class="n">root</span><span class="p">:</span>
                        <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_ut_root</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">ut_unit</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If other is a float equal to its integer tehn raise</span>
                <span class="c1"># to the integer part. E.g. if other is 3.0 then we</span>
                <span class="c1"># raise to the power of 3; if other is -2.0 then we</span>
                <span class="c1"># raise to the power of -2</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">root</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="n">root</span><span class="p">:</span>
                        <span class="n">ut_unit</span> <span class="o">=</span> <span class="n">_ut_raise</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_c_int</span><span class="p">(</span><span class="n">root</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">ut_unit</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="c1">#--- End: if</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> ** </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>


    <span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__isub__(y) &lt;==&gt; x-=y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="n">other</span>


    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__iadd__(y) &lt;==&gt; x+=y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>


    <span class="k">def</span> <span class="fm">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The augmented arithmetic assignment ``*=``</span>

<span class="sd">    x.__imul__(y) &lt;==&gt; x*=y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>


    <span class="k">def</span> <span class="fm">__idiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The augmented arithmetic assignment ``/=``</span>

<span class="sd">    x.__idiv__(y) &lt;==&gt; x/=y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">/</span> <span class="n">other</span>


    <span class="k">def</span> <span class="fm">__ipow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The augmented arithmetic assignment ``**=``</span>

<span class="sd">    x.__ipow__(y) &lt;==&gt; x**=y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">**</span> <span class="n">other</span>


    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The binary arithmetic operation ``-`` with reflected operands</span>

<span class="sd">    x.__rsub__(y) &lt;==&gt; y-x</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do {0!r} - {1!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>


    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The binary arithmetic operation ``+`` with reflected operands</span>

<span class="sd">    x.__radd__(y) &lt;==&gt; y+x</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>


    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The binary arithmetic operation ``*`` with reflected operands</span>

<span class="sd">    x.__rmul__(y) &lt;==&gt; y*x</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>


    <span class="k">def</span> <span class="fm">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__rdiv__(y) &lt;==&gt; y/x</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">other</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> / </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>


    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__floordiv__(y) &lt;==&gt; x//y &lt;==&gt; x/y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">/</span> <span class="n">other</span>


    <span class="k">def</span> <span class="fm">__ifloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__ifloordiv__(y) &lt;==&gt; x//=y &lt;==&gt; x/=y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">/</span> <span class="n">other</span>

 
    <span class="k">def</span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__rfloordiv__(y) &lt;==&gt; y//x &lt;==&gt; y/x</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">other</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> // </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>


 
    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__truediv__(y) &lt;==&gt; x/y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__div__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__itruediv__(y) &lt;==&gt; x/=y</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__idiv__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

 
    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__rtruediv__(y) &lt;==&gt; y/x</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__rdiv__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
<span class="c1">#        try:</span>
<span class="c1">#            return (self ** -1) * other</span>
<span class="c1">#        except:</span>
<span class="c1">#            raise ValueError(&quot;Can&#39;t do %r / %r&quot; % (other, self))</span>


    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;TODO</span>

<span class="sd">        &#39;&#39;&#39;</span>   
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t do </span><span class="si">%r</span><span class="s2"> </span><span class="si">%%</span><span class="s2"> </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>



    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The unary arithmetic operation ``-``</span>

<span class="sd">    x.__neg__() &lt;==&gt; -x</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>


    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The unary arithmetic operation ``+``</span>

<span class="sd">    x.__pos__() &lt;==&gt; +x</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span>


    <span class="c1"># ----------------------------------------------------------------</span>
    <span class="c1"># Private methods</span>
    <span class="c1"># ----------------------------------------------------------------</span>
    <span class="k">def</span> <span class="nf">_comparison</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cv_converter</span> <span class="o">=</span> <span class="n">_ut_get_converter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Units are not compatible: {0!r}, {1!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cv_converter</span><span class="p">:</span>
            <span class="n">_cv_free</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Units are not compatible: {0!r}, {1!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>

        <span class="n">y</span>  <span class="o">=</span> <span class="n">_c_double</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">pointer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">_cv_convert_doubles</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">,</span>
                            <span class="n">pointer</span><span class="p">,</span>
                            <span class="n">_c_size_t</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                            <span class="n">pointer</span><span class="p">)</span>
        <span class="n">_cv_free</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="n">method</span><span class="p">)(</span><span class="n">y</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_new_reason_notvalid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;TODO</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">_reason_notvalid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reason_notvalid</span>
        <span class="k">if</span> <span class="n">_reason_notvalid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reason_notvalid</span> <span class="o">=</span> <span class="n">_reason_notvalid</span><span class="o">+</span><span class="s1">&#39;; &#39;</span><span class="o">+</span><span class="n">reason</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reason_notvalid</span> <span class="o">=</span> <span class="n">reason</span>

            
    <span class="c1"># ----------------------------------------------------------------</span>
    <span class="c1"># Attributes</span>
    <span class="c1"># ----------------------------------------------------------------</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isreftime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;True if the units are reference time units, False otherwise.</span>

<span class="sd">    Note that time units (such as ``&#39;days&#39;``) are not reference time</span>
<span class="sd">    units.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: `isdimensionless`, `islongitude`, `islatitude`,</span>
<span class="sd">                 `ispressure`, `istime`</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;days since 2000-12-1 03:00&#39;).isreftime</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;hours since 2100-1-1&#39;, calendar=&#39;noleap&#39;).isreftime</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(calendar=&#39;360_day&#39;).isreftime</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;days&#39;).isreftime</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;kg&#39;).isreftime</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units().isreftime</span>
<span class="sd">    False</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">iscalendartime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;True if the units are calendar time units, False otherwise.</span>

<span class="sd">    Note that regular time units (such as ``&#39;days&#39;``) are not calendar</span>
<span class="sd">    time units.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: `isdimensionless`, `islongitude`, `islatitude`,</span>
<span class="sd">                 `ispressure`, `isreftime`, `istime`</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;calendar_months&#39;).iscalendartime</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;calendar_years&#39;).iscalendartime</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;days&#39;).iscalendartime</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;km s-1&#39;).iscalendartime</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;kg&#39;).isreftime</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;&#39;).isreftime</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units().isreftime</span>
<span class="sd">    False</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_ut_are_convertible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">_calendartime_ut_unit</span><span class="p">))</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isdimensionless</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;True if the units are dimensionless, false otherwise.</span>

<span class="sd">    .. seealso:: `islongitude`, `islatitude`, `ispressure`, `isreftime`,</span>
<span class="sd">                 `istime`</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;&#39;).isdimensionless</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;1&#39;).isdimensionless</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;100&#39;).isdimensionless</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;m/m&#39;).isdimensionless</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;m km-1&#39;).isdimensionless</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units().isdimensionless</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;m&#39;).isdimensionless</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;m/s&#39;).isdimensionless</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;days since 2000-1-1&#39;, calendar=&#39;noleap&#39;).isdimensionless</span>
<span class="sd">    False</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_ut_are_convertible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">_dimensionless_unit_one</span><span class="p">))</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ispressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;True if the units are pressure units, false otherwise.</span>
<span class="sd">  </span>
<span class="sd">    .. seealso:: `isdimensionless`, `islongitude`, `islatitude`,</span>
<span class="sd">                 `isreftime`, `istime`</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;bar&#39;).ispressure</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;hPa&#39;).ispressure</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;meter^-1-kilogram-second^-2&#39;).ispressure</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;hours since 2100-1-1&#39;, calendar=&#39;noleap&#39;).ispressure</span>
<span class="sd">    False</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ut_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>
        <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_ut_are_convertible</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_pressure_ut_unit</span><span class="p">))</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">islatitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;True if and only if the units are latitude units.</span>

<span class="sd">    This is the case if and only if the `units` attribute is one of</span>
<span class="sd">    ``&#39;degrees_north&#39;``, ``&#39;degree_north&#39;``, ``&#39;degree_N&#39;``,</span>
<span class="sd">    ``&#39;degrees_N&#39;``, ``&#39;degreeN&#39;``, and ``&#39;degreesN&#39;``.</span>
<span class="sd">    </span>
<span class="sd">    Note that units of ``&#39;degrees&#39;`` are not latitude units.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: `isdimensionless`, `islongitude`, `ispressure`,</span>
<span class="sd">                 `isreftime`, `istime`</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;degrees_north&#39;).islatitude</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;degrees&#39;).islatitude</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;degrees_east&#39;).islatitude</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;kg&#39;).islatitude</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units().islatitude</span>
<span class="sd">    False</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;degrees_north&#39;</span><span class="p">,</span> <span class="s1">&#39;degree_north&#39;</span><span class="p">,</span> <span class="s1">&#39;degree_N&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;degrees_N&#39;</span><span class="p">,</span> <span class="s1">&#39;degreeN&#39;</span><span class="p">,</span> <span class="s1">&#39;degreesN&#39;</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">islongitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;True if and only if the units are longitude units.</span>

<span class="sd">    This is the case if and only if the `units` attribute is one of</span>
<span class="sd">    ``&#39;degrees_east&#39;``, ``&#39;degree_east&#39;``, ``&#39;degree_E&#39;``,</span>
<span class="sd">    ``&#39;degrees_E&#39;``, ``&#39;degreeE&#39;``, and ``&#39;degreesE&#39;``.</span>
<span class="sd">    </span>
<span class="sd">    Note that units of ``&#39;degrees&#39;`` are not longitude units.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: `isdimensionless`, `islatitude`, `ispressure`,</span>
<span class="sd">                 `isreftime`, `istime`</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;degrees_east&#39;).islongitude</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;degrees&#39;).islongitude</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;degrees_north&#39;).islongitude</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;kg&#39;).islongitude</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units().islongitude</span>
<span class="sd">    False</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;degrees_east&#39;</span><span class="p">,</span> <span class="s1">&#39;degree_east&#39;</span><span class="p">,</span> <span class="s1">&#39;degree_E&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;degrees_E&#39;</span><span class="p">,</span> <span class="s1">&#39;degreeE&#39;</span><span class="p">,</span> <span class="s1">&#39;degreesE&#39;</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">istime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;True if the units are time units, False otherwise.</span>

<span class="sd">    Note that reference time units (such as ``&#39;days since</span>
<span class="sd">    2000-12-1&#39;``) are not time units, nor are calendar years and</span>
<span class="sd">    calendar months.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: `iscalendartime`, `isdimensionless`, `islongitude`,</span>
<span class="sd">                 `islatitude`, `ispressure`, `isreftime`</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;days&#39;).istime</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;seconds&#39;).istime</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;kg&#39;).istime</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units().istime</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;hours since 2100-1-1&#39;, calendar=&#39;noleap&#39;).istime</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(calendar=&#39;360_day&#39;).istime</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;calendar_years&#39;).istime</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;calendar_months&#39;).istime</span>
<span class="sd">    False</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="n">ut_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>
        <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_ut_are_convertible</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_day_ut_unit</span><span class="p">))</span>

 
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">isvalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Whether the units are valid.</span>

<span class="sd">    .. seealso:: `reason_notvalid`</span>

<span class="sd">    **Examples:**</span>

<span class="sd">    &gt;&gt;&gt; u = Units(&#39;km&#39;)</span>
<span class="sd">    &gt;&gt;&gt;  u.isvalid                                                               </span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; u.reason_notvalid                                                       </span>
<span class="sd">    &#39;&#39;</span>

<span class="sd">    &gt;&gt;&gt; u = Units(&#39;Bad Units&#39;)                                                 </span>
<span class="sd">    &gt;&gt;&gt; u.isvalid                                                               </span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; u.reason_notvalid                                                       </span>
<span class="sd">    &quot;Invalid units: &#39;Bad Units&#39;; Not recognised by UDUNITS&quot;</span>

<span class="sd">    &gt;&gt;&gt; u = Units(days since 2000-1-1&#39;, calendar=&#39;Bad Calendar&#39;)</span>
<span class="sd">    &gt;&gt;&gt;  u.isvalid                                                               </span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; u.reason_notvalid                                                       </span>
<span class="sd">    &quot;Invalid calendar=&#39;Bad Calendar&#39;; calendar must be one of [&#39;standard&#39;, &#39;gregorian&#39;, &#39;proleptic_gregorian&#39;, &#39;noleap&#39;, &#39;julian&#39;, &#39;all_leap&#39;, &#39;365_day&#39;, &#39;366_day&#39;, &#39;360_day&#39;], got &#39;bad calendar&#39;&quot;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_isvalid&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reason_notvalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The reason for invalid units.</span>

<span class="sd">    If the units are valid then the reason is an empty string.</span>

<span class="sd">    .. seealso:: `isvalid`</span>
<span class="sd">        </span>
<span class="sd">    **Examples:**</span>

<span class="sd">    &gt;&gt;&gt; u = Units(&#39;km&#39;)</span>
<span class="sd">    &gt;&gt;&gt;  u.isvalid                                                               </span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; u.reason_notvalid                                                       </span>
<span class="sd">    &#39;&#39;</span>

<span class="sd">    &gt;&gt;&gt; u = Units(&#39;Bad Units&#39;)                                                 </span>
<span class="sd">    &gt;&gt;&gt; u.isvalid                                                               </span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; u.reason_notvalid                                                       </span>
<span class="sd">    &quot;Invalid units: &#39;Bad Units&#39;; Not recognised by UDUNITS&quot;</span>

<span class="sd">    &gt;&gt;&gt; u = Units(days since 2000-1-1&#39;, calendar=&#39;Bad Calendar&#39;)</span>
<span class="sd">    &gt;&gt;&gt;  u.isvalid                                                               </span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; u.reason_notvalid                                                       </span>
<span class="sd">    &quot;Invalid calendar=&#39;Bad Calendar&#39;; calendar must be one of [&#39;standard&#39;, &#39;gregorian&#39;, &#39;proleptic_gregorian&#39;, &#39;noleap&#39;, &#39;julian&#39;, &#39;all_leap&#39;, &#39;365_day&#39;, &#39;366_day&#39;, &#39;360_day&#39;], got &#39;bad calendar&#39;&quot;</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_reason_notvalid&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reftime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The reference date-time of reference time units.</span>

<span class="sd">    .. seealso:: `calendar`, `isreftime`, `units`</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;days since 1900-1-1&#39;).reftime</span>
<span class="sd">    &lt;Datetime: 1900-01-01 00:00:00&gt;</span>
<span class="sd">    &gt;&gt;&gt; str(Units(&#39;days since 1900-1-1 03:00&#39;).reftime)</span>
<span class="sd">    &#39;1900-01-01 03:00:00&#39;</span>
<span class="sd">    </span>
<span class="sd">    TODO</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isreftime</span><span class="p">:</span>
            <span class="n">utime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utime</span>
            <span class="k">if</span> <span class="n">utime</span><span class="p">:</span>
                <span class="n">origin</span> <span class="o">=</span> <span class="n">utime</span><span class="o">.</span><span class="n">origin</span>
                <span class="k">if</span> <span class="n">origin</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">origin</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Some refrence date-times do not have a utime, such</span>
                <span class="c1"># as those defined by monts or years</span>
                <span class="k">return</span> <span class="n">cftime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">cftime</span><span class="o">.</span><span class="n">_parse_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; since &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1">#--- End: if</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;{0!r} has no attribute &#39;reftime&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">calendar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The calendar for reference time units.</span>

<span class="sd">    May be any string allowed by the calendar CF property.</span>
<span class="sd">    </span>
<span class="sd">    If it is unset then the default CF calendar is assumed when</span>
<span class="sd">    required.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: `units`</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units(calendar=&#39;365_day&#39;).calendar</span>
<span class="sd">    &#39;365_day&#39;</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;days since 2001-1-1&#39;, calendar=&#39;noleap&#39;).calendar</span>
<span class="sd">    &#39;noleap&#39;</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;days since 2001-1-1&#39;).calendar</span>
<span class="sd">    AttributeError: Units has no attribute &#39;calendar&#39;</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> has no attribute &#39;calendar&#39;&quot;</span> <span class="o">%</span>
                             <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>    


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">units</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;The units.</span>

<span class="sd">    May be any string allowed by the units CF property.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: `calendar`</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;kg&#39;).units</span>
<span class="sd">    &#39;kg&#39;</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;seconds&#39;).units</span>
<span class="sd">    &#39;seconds&#39;</span>
<span class="sd">    &gt;&gt;&gt; Units(&#39;days since 2000-1-1&#39;, calendar=&#39;366_day&#39;).units</span>
<span class="sd">    &#39;days since 2000-1-1&#39;</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39; object has no attribute &#39;units&#39;&quot;</span> <span class="o">%</span>
                             <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>


    <span class="c1"># ----------------------------------------------------------------</span>
    <span class="c1"># Methods</span>
    <span class="c1"># ----------------------------------------------------------------</span>
<div class="viewcode-block" id="Units.equivalent"><a class="viewcode-back" href="../../generated/cfunits.Units.equivalent.html#cfunits.Units.equivalent">[docs]</a>    <span class="k">def</span> <span class="nf">equivalent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns True if numeric values in one unit are convertible to</span>
<span class="sd">    numeric values in the other unit.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: `equals`</span>
<span class="sd">    </span>
<span class="sd">    :Parameters:</span>
<span class="sd">    </span>
<span class="sd">        other: `Units`</span>
<span class="sd">            The other units.</span>
<span class="sd">    </span>
<span class="sd">    :Returns:</span>
<span class="sd">    </span>
<span class="sd">        `bool`</span>
<span class="sd">            True if the units are equivalent, False otherwise.</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;m&#39;)</span>
<span class="sd">    &gt;&gt;&gt; v = Units(&#39;km&#39;)</span>
<span class="sd">    &gt;&gt;&gt; w = Units(&#39;s&#39;)</span>

<span class="sd">    &gt;&gt;&gt; u.equivalent(v)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; u.equivalent(w)</span>
<span class="sd">    False</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;days since 2000-1-1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; v = Units(&#39;days since 2000-1-1&#39;, calendar=&#39;366_day&#39;)</span>
<span class="sd">    &gt;&gt;&gt; w = Units(&#39;seconds since 1978-3-12&#39;, calendar=&#39;gregorian)</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u.equivalent(v)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; u.equivalent(w)</span>
<span class="sd">    True</span>

<span class="sd">        &#39;&#39;&#39;</span>
<span class="c1">#        if not self.isvalid or not other.isvalid:</span>
<span class="c1">#            return False</span>
        
        <span class="n">isreftime1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span>
        <span class="n">isreftime2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span>

<span class="c1">#        if isreftime1 and isreftime2:</span>
<span class="c1">#            # Both units are reference-time units</span>
<span class="c1">#            if self._canonical_calendar != other._canonical_calendar:</span>
<span class="c1">#                if verbose:</span>
<span class="c1">#                    print(&quot;{}: Incompatible calendars: {!r}, {!r}&quot;.format(</span>
<span class="c1">#                        self.__class__.__name__,</span>
<span class="c1">#                        self._calendar, other._calendar)) # pragma: no cover</span>
<span class="c1">#                return False</span>
<span class="c1">#</span>
<span class="c1">#            reftime0 = getattr(self, &#39;reftime&#39;, None)</span>
<span class="c1">#            reftime1 = getattr(other, &#39;reftime&#39;, None)</span>
<span class="c1">#            if reftime0 != reftime1:</span>
<span class="c1">#                if verbose:</span>
<span class="c1">#                    print(&quot;{}: Different reference date-times: {!r}, {!r}&quot;.format(</span>
<span class="c1">#                        self.__class__.__name__,</span>
<span class="c1">#                        reftime0, reftime1)) # pragma: no cover</span>
<span class="c1">#                return False</span>
<span class="c1">#</span>
<span class="c1">#        elif isreftime1 or isreftime2:</span>
<span class="c1">#            if verbose:</span>
<span class="c1">#                print(&quot;{}: Only one is reference time&quot;.format(</span>
<span class="c1">#                    self.__class__.__name__)) # pragma: no cover</span>
<span class="c1">#            return False</span>

        
        <span class="k">if</span> <span class="n">isreftime1</span> <span class="ow">and</span> <span class="n">isreftime2</span><span class="p">:</span>
            <span class="c1"># Both units are reference-time units</span>
            <span class="n">units0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_units</span>
            <span class="n">units1</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_units</span>
            <span class="k">if</span> <span class="n">units0</span> <span class="ow">and</span> <span class="n">units1</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">units0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">units1</span><span class="p">):</span>
                <span class="n">out</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_canonical_calendar</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_canonical_calendar</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">out</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}: Incompatible calendars: {!r}, {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_calendar</span><span class="p">))</span> <span class="c1"># pragma: no cover</span>
                
                <span class="k">return</span> <span class="n">out</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="k">elif</span> <span class="n">isreftime1</span> <span class="ow">or</span> <span class="n">isreftime2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}: Only one is reference time&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span> <span class="c1"># pragma: no cover</span>
            <span class="k">return</span> <span class="bp">False</span>
        
<span class="c1">#        if not self.isvalid:</span>
<span class="c1">#            if verbose:</span>
<span class="c1">#                print(&quot;{}: {!r} is not valid&quot;.format(self.__class__.__name__, self)) # pragma: no cover</span>
<span class="c1">#            return False</span>
<span class="c1">#        </span>
<span class="c1">#        if not other.isvalid:</span>
<span class="c1">#            if verbose:</span>
<span class="c1">#                print(&quot;{}: {!r} is not valid&quot;.format(self.__class__.__name__, other)) # pragma: no cover</span>
<span class="c1">#            return False</span>
        
<span class="c1">#         if isreftime1 and isreftime2:</span>
<span class="c1">#            # Both units are reference-time units</span>
<span class="c1">#            units0 = self._units</span>
<span class="c1">#            units1 = other._units</span>
<span class="c1">#            if units0 and units1 or (not units0 and not units1):</span>
<span class="c1">#                return self._calendar == other._calendar</span>
<span class="c1">#            else:</span>
<span class="c1">#                return False</span>
<span class="c1">#        #--- End: if</span>

        <span class="c1"># Still here? </span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">other</span><span class="p">:</span>
            <span class="c1"># Both units are null and therefore equivalent</span>
            <span class="k">return</span> <span class="bp">True</span>

<span class="c1">#        if not isreftime1 and not isreftime2:</span>
            <span class="c1"># Both units are not reference-time units</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">_ut_are_convertible</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">))</span></div>
         
        <span class="c1"># Still here? Then units are not equivalent.</span>
<span class="c1">#        return False</span>


<div class="viewcode-block" id="Units.formatted"><a class="viewcode-back" href="../../generated/cfunits.Units.formatted.html#cfunits.Units.formatted">[docs]</a>    <span class="k">def</span> <span class="nf">formatted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">definition</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Formats the string stored in the `units` attribute in a</span>
<span class="sd">    standardized manner. The `units` attribute is modified in place</span>
<span class="sd">    and its new value is returned.</span>
<span class="sd">    </span>
<span class="sd">    :Parameters:</span>
<span class="sd">    </span>
<span class="sd">        names: `bool`, optional</span>
<span class="sd">            Use unit names instead of symbols.</span>
<span class="sd">    </span>
<span class="sd">        definition: `bool`, optional</span>
<span class="sd">            The formatted string is given in terms of basic units</span>
<span class="sd">            instead of stopping any expansion at the highest level</span>
<span class="sd">            possible.</span>
<span class="sd">    </span>
<span class="sd">    :Returns:</span>
<span class="sd">    </span>
<span class="sd">        `str` or `None`</span>
<span class="sd">            The formatted string. If the units have not yet been set,</span>
<span class="sd">            then `None` is returned.</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;W&#39;)</span>
<span class="sd">    &gt;&gt;&gt; u.units</span>
<span class="sd">    &#39;W&#39;</span>
<span class="sd">    &gt;&gt;&gt; u.units = u.format(names=True)</span>
<span class="sd">    &gt;&gt;&gt; u.units</span>
<span class="sd">    &#39;watt&#39;</span>
<span class="sd">    &gt;&gt;&gt; u.units = u.format(definition=True)</span>
<span class="sd">    &gt;&gt;&gt; u.units</span>
<span class="sd">    &#39;m2.kg.s-3&#39;</span>
<span class="sd">    &gt;&gt;&gt; u.units = u.format(names=True, definition=True)</span>
<span class="sd">    &#39;meter^2-kilogram-second^-3&#39;</span>
<span class="sd">    &gt;&gt;&gt; u.units = u.format()</span>
<span class="sd">    &gt;&gt;&gt; u.units</span>
<span class="sd">    &#39;W&#39;</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u.units = &#39;dram&#39;</span>
<span class="sd">    &gt;&gt;&gt; u.format(names=True)</span>
<span class="sd">    &#39;1.848345703125e-06 meter^3&#39;</span>
<span class="sd">    </span>
<span class="sd">    Formatting is also available during object initialization:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;m/s&#39;, format=True)</span>
<span class="sd">    &gt;&gt;&gt; u.units</span>
<span class="sd">    &#39;m.s-1&#39;</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;dram&#39;, names=True)</span>
<span class="sd">    &gt;&gt;&gt; u.units</span>
<span class="sd">    &#39;1.848345703125e-06 m3&#39;</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;Watt&#39;)</span>
<span class="sd">    &gt;&gt;&gt; u.units</span>
<span class="sd">    &#39;Watt&#39;</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;Watt&#39;, formatted=True)</span>
<span class="sd">    &gt;&gt;&gt; u.units</span>
<span class="sd">    &#39;W&#39;</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;Watt&#39;, names=True)</span>
<span class="sd">    &gt;&gt;&gt; u.units</span>
<span class="sd">    &#39;watt&#39;</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;Watt&#39;, definition=True)</span>
<span class="sd">    &gt;&gt;&gt; u.units</span>
<span class="sd">    &#39;m2.kg.s-3&#39;</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;Watt&#39;, names=True, definition=True)</span>
<span class="sd">    &gt;&gt;&gt; u.units</span>
<span class="sd">    &#39;meter^2-kilogram-second^-3&#39;</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ut_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span>

        <span class="k">if</span> <span class="n">ut_unit</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="n">opts</span> <span class="o">=</span> <span class="n">_UT_ASCII</span>
        <span class="k">if</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">|=</span> <span class="n">_UT_NAMES</span>
        <span class="k">if</span> <span class="n">definition</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">|=</span> <span class="n">_UT_DEFINITION</span>

        <span class="k">if</span> <span class="n">_ut_format</span><span class="p">(</span><span class="n">ut_unit</span><span class="p">,</span> <span class="n">_string_buffer</span><span class="p">,</span> <span class="n">_sizeof_buffer</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">_string_buffer</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t format unit {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isreftime</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="s1">&#39; since &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reftime</span><span class="o">.</span><span class="n">strftime</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">out</span>

        <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Units.conform"><a class="viewcode-back" href="../../generated/cfunits.Units.conform.html#cfunits.Units.conform">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">conform</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">from_units</span><span class="p">,</span> <span class="n">to_units</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Conform values in one unit to equivalent values in another,</span>
<span class="sd">    compatible unit.</span>

<span class="sd">    Returns the conformed values.</span>
<span class="sd">    </span>
<span class="sd">    The values may either be a numpy array or a python numeric</span>
<span class="sd">    type. The returned value is of the same type, except that input</span>
<span class="sd">    integers are converted to floats (see the *inplace* keyword).</span>
<span class="sd">    </span>
<span class="sd">    .. warning:: Do not change the calendar of reference time units in</span>
<span class="sd">                 the current version. Whilst this is possible, it will</span>
<span class="sd">                 almost certainly result in an incorrect</span>
<span class="sd">                 interpretation of the data or an error.</span>

<span class="sd">    :Parameters:</span>
<span class="sd">    </span>
<span class="sd">        x: `numpy.ndarray` or python numeric object</span>
<span class="sd">    </span>
<span class="sd">        from_units: `Units`</span>
<span class="sd">            The original units of *x*</span>
<span class="sd">    </span>
<span class="sd">        to_units: `Units`</span>
<span class="sd">            The units to which *x* should be conformed to.</span>
<span class="sd">    </span>
<span class="sd">        inplace: `bool`, optional</span>
<span class="sd">            If True and *x* is a numpy array then change it in place,</span>
<span class="sd">            creating no temporary copies, with one exception: If *x*</span>
<span class="sd">            is of integer type and the conversion is not null, then it</span>
<span class="sd">            will not be changed inplace and the returned conformed</span>
<span class="sd">            array will be of float type.</span>
<span class="sd">    </span>
<span class="sd">    :Returns:</span>
<span class="sd">    </span>
<span class="sd">        `numpy.ndarray` or python numeric</span>
<span class="sd">            The modified numeric values.</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units.conform(2, Units(&#39;km&#39;), Units(&#39;m&#39;))</span>
<span class="sd">    2000.0</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import numpy</span>
<span class="sd">    &gt;&gt;&gt; a = numpy.arange(5.0)</span>
<span class="sd">    &gt;&gt;&gt; Units.conform(a, Units(&#39;minute&#39;), Units(&#39;second&#39;))</span>
<span class="sd">    array([   0.,   60.,  120.,  180.,  240.])</span>
<span class="sd">    &gt;&gt;&gt; print(a)</span>
<span class="sd">    [ 0.  1.  2.  3.  4.]</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; Units.conform(a,</span>
<span class="sd">                      Units(&#39;days since 2000-12-1&#39;),</span>
<span class="sd">                      Units(&#39;days since 2001-1-1&#39;), inplace=True)</span>
<span class="sd">    array([-31., -30., -29., -28., -27.])</span>
<span class="sd">    &gt;&gt;&gt; print(a)</span>
<span class="sd">    [-31. -30. -29. -28. -27.]</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">from_units</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">to_units</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1">#--- End: if</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">from_units</span><span class="o">.</span><span class="n">equivalent</span><span class="p">(</span><span class="n">to_units</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Units are not convertible: {!r}, {1r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">from_units</span><span class="p">,</span> <span class="n">to_units</span><span class="p">))</span>

        <span class="n">ut_unit1</span> <span class="o">=</span> <span class="n">from_units</span><span class="o">.</span><span class="n">_ut_unit</span>
        <span class="n">ut_unit2</span> <span class="o">=</span> <span class="n">to_units</span><span class="o">.</span><span class="n">_ut_unit</span>

        <span class="k">if</span> <span class="n">ut_unit1</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">ut_unit2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Units are not convertible: {!r}, {1r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">from_units</span><span class="p">,</span> <span class="n">to_units</span><span class="p">))</span>

        <span class="n">convert</span> <span class="o">=</span> <span class="n">_ut_compare</span><span class="p">(</span><span class="n">ut_unit1</span><span class="p">,</span> <span class="n">ut_unit2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">from_units</span><span class="o">.</span><span class="n">_isreftime</span> <span class="ow">and</span> <span class="n">to_units</span><span class="o">.</span><span class="n">_isreftime</span><span class="p">:</span>
            <span class="c1"># --------------------------------------------------------</span>
            <span class="c1"># Both units are time-reference units, so calculate the</span>
            <span class="c1"># non-zero offset in units of days.</span>
            <span class="c1"># --------------------------------------------------------</span>
            <span class="n">units0</span><span class="p">,</span> <span class="n">reftime0</span> <span class="o">=</span> <span class="n">from_units</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; since &#39;</span><span class="p">)</span>
            <span class="n">units1</span><span class="p">,</span> <span class="n">reftime1</span> <span class="o">=</span> <span class="n">to_units</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; since &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">units0</span> <span class="ow">in</span> <span class="n">_months_or_years</span><span class="p">:</span>
                <span class="n">from_units</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="s1">&#39;days since &#39;</span><span class="o">+</span><span class="n">reftime0</span><span class="p">,</span>
                                 <span class="n">calendar</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">from_units</span><span class="p">,</span> <span class="s1">&#39;calendar&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">numpy_asanyarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">units0</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;months&#39;</span><span class="p">):</span>                    
                        <span class="n">x</span> <span class="o">*=</span> <span class="n">_month_length</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">*=</span> <span class="n">_year_length</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">units0</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;months&#39;</span><span class="p">):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">_month_length</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">_year_length</span>
                        
                    <span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span>

                <span class="n">ut_unit1</span> <span class="o">=</span> <span class="n">from_units</span><span class="o">.</span><span class="n">_ut_unit</span>
                <span class="n">ut_unit2</span> <span class="o">=</span> <span class="n">to_units</span><span class="o">.</span><span class="n">_ut_unit</span>

                <span class="n">convert</span> <span class="o">=</span> <span class="n">_ut_compare</span><span class="p">(</span><span class="n">ut_unit1</span><span class="p">,</span> <span class="n">ut_unit2</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">units1</span> <span class="ow">in</span> <span class="n">_months_or_years</span><span class="p">:</span>
                <span class="n">to_units</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="s1">&#39;days since &#39;</span><span class="o">+</span><span class="n">reftime1</span><span class="p">,</span>
                               <span class="n">calendar</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">to_units</span><span class="p">,</span> <span class="s1">&#39;calendar&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
                
            <span class="n">offset</span> <span class="o">=</span> <span class="n">to_units</span><span class="o">.</span><span class="n">_utime</span><span class="o">.</span><span class="n">_jd0</span> <span class="o">-</span> <span class="n">from_units</span><span class="o">.</span><span class="n">_utime</span><span class="o">.</span><span class="n">_jd0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># ------------------------------------------------------------</span>
        <span class="c1"># If the two units are identical then no need to alter the</span>
        <span class="c1"># value, so return it unchanged.</span>
        <span class="c1"># ------------------------------------------------------------</span>
<span class="c1">#        if not convert and not offset:</span>
<span class="c1">#            return x</span>

        <span class="k">if</span> <span class="n">convert</span><span class="p">:</span>
            <span class="n">cv_converter</span> <span class="o">=</span> <span class="n">_ut_get_converter</span><span class="p">(</span><span class="n">ut_unit1</span><span class="p">,</span> <span class="n">ut_unit2</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cv_converter</span><span class="p">:</span>
                <span class="n">_cv_free</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Units are not convertible: {!r}, {1r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">from_units</span><span class="p">,</span> <span class="n">to_units</span><span class="p">))</span>
        <span class="c1">#-- End: if</span>

        <span class="c1"># ------------------------------------------------------------</span>
        <span class="c1"># Find out if x is an numpy array or a python number</span>
        <span class="c1"># ------------------------------------------------------------</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">numpy_generic</span><span class="p">):</span>
            <span class="c1"># Convert a generic numpy scalar to a 0-d array</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">numpy_ndarray</span><span class="p">):</span>
            <span class="n">x_is_numpy</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_is_numpy</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">flags</span><span class="o">.</span><span class="n">contiguous</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;C&#39;</span><span class="p">)</span>
<span class="c1">#ARRRGGHH dch</span>

            <span class="c1"># --------------------------------------------------------</span>
            <span class="c1"># Convert an integer numpy array to a float numpy array</span>
            <span class="c1"># --------------------------------------------------------</span>
            <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="ow">is</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
                        <span class="n">y</span>      <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                        <span class="n">y</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy_dtype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="ow">is</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
                        <span class="n">y</span>      <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                        <span class="n">y</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">numpy_dtype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># At numpy vn1.7 astype has many more keywords ...</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">is</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="ow">is</span> <span class="s1">&#39;i&#39;</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">char</span> <span class="ow">is</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1">#--- End: if</span>

        <span class="c1"># ------------------------------------------------------------</span>
        <span class="c1"># Convert the array to the new units</span>
        <span class="c1"># ------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">convert</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">x_is_numpy</span><span class="p">:</span>
                <span class="c1"># Create a pointer to the array cast to the appropriate</span>
                <span class="c1"># ctypes object</span>
                <span class="n">itemsize</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>
                <span class="n">pointer</span>  <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">_ctypes_POINTER</span><span class="p">[</span><span class="n">itemsize</span><span class="p">])</span>

                <span class="c1"># Convert the array in place</span>
                <span class="n">_cv_convert_array</span><span class="p">[</span><span class="n">itemsize</span><span class="p">](</span><span class="n">cv_converter</span><span class="p">,</span>
                                            <span class="n">pointer</span><span class="p">,</span>
                                            <span class="n">_c_size_t</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
                                            <span class="n">pointer</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Create a pointer to the number cast to a ctypes double</span>
                <span class="c1"># object.</span>
                <span class="n">y</span>  <span class="o">=</span> <span class="n">_c_double</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="n">pointer</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">pointer</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="c1"># Convert the pointer</span>
                <span class="n">_cv_convert_doubles</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">,</span>
                                    <span class="n">pointer</span><span class="p">,</span>
                                    <span class="n">_c_size_t</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
                                    <span class="n">pointer</span><span class="p">)</span>
                <span class="c1"># Reset the number</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span>

            <span class="n">_cv_free</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">)</span>

        <span class="c1"># ------------------------------------------------------------</span>
        <span class="c1"># Apply an offset for reference-time units</span>
        <span class="c1"># ------------------------------------------------------------</span>
        <span class="k">if</span> <span class="n">offset</span><span class="p">:</span>
            <span class="c1"># Convert the offset from &#39;days&#39; to the correct units and</span>
            <span class="c1"># subtract it from x</span>
            <span class="k">if</span> <span class="n">_ut_compare</span><span class="p">(</span><span class="n">_day_ut_unit</span><span class="p">,</span> <span class="n">ut_unit2</span><span class="p">):</span>

                <span class="n">cv_converter</span> <span class="o">=</span> <span class="n">_ut_get_converter</span><span class="p">(</span><span class="n">_day_ut_unit</span><span class="p">,</span> <span class="n">ut_unit2</span><span class="p">)</span>
                <span class="n">scale</span>   <span class="o">=</span> <span class="n">numpy_array</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
                <span class="n">pointer</span> <span class="o">=</span> <span class="n">scale</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
                <span class="n">_cv_convert_doubles</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">,</span>
                                    <span class="n">pointer</span><span class="p">,</span>
                                    <span class="n">_c_size_t</span><span class="p">(</span><span class="n">scale</span><span class="o">.</span><span class="n">size</span><span class="p">),</span>
                                    <span class="n">pointer</span><span class="p">)</span>
                <span class="n">_cv_free</span><span class="p">(</span><span class="n">cv_converter</span><span class="p">)</span>

                <span class="n">offset</span> <span class="o">*=</span> <span class="n">scale</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

            <span class="n">x</span> <span class="o">-=</span> <span class="n">offset</span>

        <span class="k">return</span> <span class="n">x</span></div>


<div class="viewcode-block" id="Units.copy"><a class="viewcode-back" href="../../generated/cfunits.Units.copy.html#cfunits.Units.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return a deep copy.</span>

<span class="sd">    Equivalent to ``copy.deepcopy(u)``.</span>
<span class="sd">    </span>
<span class="sd">    :Returns:</span>
<span class="sd">    </span>
<span class="sd">            The deep copy.</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; v = u.copy()</span>
<span class="sd">    </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Units.equals"><a class="viewcode-back" href="../../generated/cfunits.Units.equals.html#cfunits.Units.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return True if and only if numeric values in one unit are</span>
<span class="sd">    convertible to numeric values in the other unit and their</span>
<span class="sd">    conversion is a scale factor of 1.</span>
<span class="sd">    </span>
<span class="sd">    .. seealso:: `equivalent`</span>
<span class="sd">    </span>
<span class="sd">    :Parameters:</span>
<span class="sd">    </span>
<span class="sd">        other: `Units`</span>
<span class="sd">            The other units.</span>
<span class="sd">    </span>
<span class="sd">    :Returns:</span>
<span class="sd">    </span>
<span class="sd">        `bool`</span>
<span class="sd">            `True` if the units are equal, `False` otherwise.</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;km&#39;)</span>
<span class="sd">    &gt;&gt;&gt; v = Units(&#39;1000m&#39;)</span>
<span class="sd">    &gt;&gt;&gt; w = Units(&#39;100000m&#39;)</span>
<span class="sd">    &gt;&gt;&gt; u.equals(v)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; u.equals(w)</span>
<span class="sd">    False</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;m s-1&#39;)</span>
<span class="sd">    &gt;&gt;&gt; m = Units(&#39;m&#39;)</span>
<span class="sd">    &gt;&gt;&gt; s = Units(&#39;s&#39;)</span>
<span class="sd">    &gt;&gt;&gt; u.equals(m)</span>
<span class="sd">    False</span>
<span class="sd">    &gt;&gt;&gt; u.equals(m/s)</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; (m/s).equals(u)</span>
<span class="sd">    True</span>
<span class="sd">    </span>
<span class="sd">    Undefined units are considered equal:</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units()</span>
<span class="sd">    &gt;&gt;&gt; v = Units()</span>
<span class="sd">    &gt;&gt;&gt; u.equals(v)</span>
<span class="sd">    True</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">isreftime1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isreftime</span>
        <span class="n">isreftime2</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_isreftime</span>

        <span class="k">if</span> <span class="n">isreftime1</span> <span class="ow">and</span> <span class="n">isreftime2</span><span class="p">:</span>
            <span class="c1"># Both units are reference-time units</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_canonical_calendar</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_canonical_calendar</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}: Incompatible calendars: {!r}, {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_calendar</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_calendar</span><span class="p">))</span> <span class="c1"># pragma: no cover</span>
                <span class="k">return</span> <span class="bp">False</span>

            <span class="n">reftime0</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;reftime&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">reftime1</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;reftime&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">reftime0</span> <span class="o">!=</span> <span class="n">reftime1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}: Different reference date-times: {!r}, {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                        <span class="n">reftime0</span><span class="p">,</span> <span class="n">reftime1</span><span class="p">))</span> <span class="c1"># pragma: no cover</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="k">elif</span> <span class="n">isreftime1</span> <span class="ow">or</span> <span class="n">isreftime2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}: Only one is reference time&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span> <span class="c1"># pragma: no cover</span>
            <span class="k">return</span> <span class="bp">False</span>

        
<span class="c1">#            utime0 = self._utime</span>
<span class="c1">#            utime1 = other._utime</span>
<span class="c1">#            if utime0 is not None and utime1 is not None:</span>
<span class="c1">#                return utime0.origin_equals(utime1)</span>
<span class="c1">#            elif utime0 is None and utime1 is None:</span>
<span class="c1">#                return self.reftime</span>
<span class="c1">#</span>
<span class="c1">#        </span>
<span class="c1">#        </span>
<span class="c1">#            units0 = self._units</span>
<span class="c1">#            units1 = other._units</span>
<span class="c1">#            if units0 and units1 or (not units0 and not units1):</span>
<span class="c1">#                out = (self._canonical_calendar == other._canonical_calendar)</span>
<span class="c1">#                if verbose and not out:</span>
<span class="c1">#                    print(&quot;{}: Incompatible calendars: {!r}, {!r}&quot;.format(</span>
<span class="c1">#                        self.__class__.__name__,</span>
<span class="c1">#                        self._calendar, other._calendar)) # pragma: no cover</span>
<span class="c1">#                </span>
<span class="c1">#                return out</span>
<span class="c1">#            else:</span>
<span class="c1">#                return False</span>
<span class="c1">#        #--- End: if</span>
<span class="c1">#        if not self.isvalid:</span>
<span class="c1">#            if verbose:</span>
<span class="c1">#                print(&quot;{}: {!r} is not valid&quot;.format(self.__class__.__name__, self)) # pragma: no cover</span>
<span class="c1">#            return False</span>
<span class="c1">#        </span>
<span class="c1">#        if not other.isvalid:</span>
<span class="c1">#            if verbose:</span>
<span class="c1">#                print(&quot;{}: {!r} is not valid&quot;.format(self.__class__.__name__, other)) # pragma: no cover</span>
<span class="c1">#            return False</span>
<span class="c1">#        </span>
        
<span class="c1">#        if not self.isvalid or not other.isvalid:</span>
<span class="c1">#            print (&#39;ppp&#39;)</span>
<span class="c1">#            return False</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_ut_compare</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">):</span>                
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">elif</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}: Different units: {!r}, {!r}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">units</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">units</span><span class="p">))</span> <span class="c1"># pragma: no cover</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span></div>


<span class="c1">#isreftime1 = self._isreftime</span>
<span class="c1">#        isreftime2 = other._isreftime</span>
<span class="c1">#</span>
<span class="c1">#        if not isreftime1 and not isreftime2:</span>
<span class="c1">#            # Neither units is reference-time so they&#39;re equal</span>
<span class="c1">#            return True</span>
<span class="c1">#</span>
<span class="c1">#        if isreftime1 and isreftime2:</span>
<span class="c1">#            # Both units are reference-time</span>
<span class="c1">#            utime0 = self._utime</span>
<span class="c1">#            utime1 = other._utime</span>
<span class="c1">#            if utime0.calendar != utime1.calendar:</span>
<span class="c1">#                return False</span>
<span class="c1">#            </span>
<span class="c1">#            return utime0.origin_equals(utime1)</span>

        <span class="c1"># One unit is a reference-time and the other is not so they&#39;re</span>
        <span class="c1"># not equal</span>
<span class="c1">#        return False</span>


<div class="viewcode-block" id="Units.log"><a class="viewcode-back" href="../../generated/cfunits.Units.log.html#cfunits.Units.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return the logarithmic unit corresponding to the given logarithmic</span>
<span class="sd">    base.</span>

<span class="sd">    :Parameters:</span>
<span class="sd">    </span>
<span class="sd">        base: `int` or `float`</span>
<span class="sd">            The logarithmic base.</span>
<span class="sd">    </span>
<span class="sd">    :Returns:</span>
<span class="sd">    </span>
<span class="sd">        `Units`</span>
<span class="sd">            The logarithmic unit corresponding to the given</span>
<span class="sd">            logarithmic base.</span>
<span class="sd">    </span>
<span class="sd">    **Examples:**</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u = Units(&#39;W&#39;, names=True)</span>
<span class="sd">    &gt;&gt;&gt; u</span>
<span class="sd">    &lt;Units: watt&gt;</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u.log(10)</span>
<span class="sd">    &lt;Units: lg(re 1 W)&gt;</span>
<span class="sd">    &gt;&gt;&gt; u.log(2)</span>
<span class="sd">    &lt;Units: lb(re 1 W)&gt;</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import math</span>
<span class="sd">    &gt;&gt;&gt; u.log(math.e)</span>
<span class="sd">    &lt;Units: ln(re 1 W)&gt;</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; u.log(3.5)</span>
<span class="sd">    &lt;Units: 0.798235600147928 ln(re 1 W)&gt;</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_ut_unit</span> <span class="o">=</span> <span class="n">_ut_log</span><span class="p">(</span><span class="n">_c_double</span><span class="p">(</span><span class="n">base</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ut_unit</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_ut_unit</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_ut_unit</span><span class="o">=</span><span class="n">_ut_unit</span><span class="p">)</span>
        <span class="c1">#--- End: try</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Can&#39;t take the logarithm to the base </span><span class="si">%r</span><span class="s2"> of </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span></div></div>


<span class="c1">#--- End: class</span>


<span class="c1"># ====================================================================</span>
<span class="c1">#</span>
<span class="c1"># Utime object</span>
<span class="c1">#</span>
<span class="c1"># ====================================================================</span>
<span class="k">class</span> <span class="nc">Utime</span><span class="p">(</span><span class="n">cftime</span><span class="o">.</span><span class="n">utime</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Performs conversions of netCDF time coordinate data to/from datetime</span>
<span class="sd">objects.</span>

<span class="sd">This object is (currently) functionally equivalent to a</span>
<span class="sd">`netCDF4.netcdftime.utime` object.</span>

<span class="sd">**Attributes**</span>

<span class="sd">==============  ======================================================</span>
<span class="sd">Attribute       Description</span>
<span class="sd">==============  ======================================================</span>
<span class="sd">`!_jd0`         </span>
<span class="sd">`!calendar`     The calendar used in the time calculation.</span>
<span class="sd">`!origin`       A date/time object for the reference time.</span>
<span class="sd">`!tzoffset`     Time zone offset in minutes.</span>
<span class="sd">`!unit_string`  </span>
<span class="sd">`!units`        </span>
<span class="sd">==============  ======================================================</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">calendar</span><span class="p">,</span> <span class="n">unit_string</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">only_use_cftime_datetimes</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;**Initialization**</span>

<span class="sd">    :Parameters:</span>
<span class="sd">    </span>
<span class="sd">        calendar: `str`</span>
<span class="sd">            The calendar used in the time calculations. Must be one</span>
<span class="sd">            of: ``&#39;gregorian&#39;``, ``&#39;360_day&#39;``, ``&#39;365_day&#39;``,</span>
<span class="sd">            ``&#39;366_day&#39;``, ``&#39;julian&#39;``, ``&#39;proleptic_gregorian&#39;``,</span>
<span class="sd">            although this is not checked.</span>
<span class="sd">    </span>
<span class="sd">        unit_string: `str`, optional</span>
<span class="sd">            A string of the form &quot;time-units since &lt;time-origin&gt;&quot;</span>
<span class="sd">            defining the reference-time units.</span>

<span class="sd">        only_use_cftime_datetimes: `bool`, optional</span>
<span class="sd">            If False, datetime.datetime objects are returned from</span>
<span class="sd">            `num2date` where possible; By default. dates which</span>
<span class="sd">            subclass `cftime.datetime` are returned for all calendars.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">unit_string</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">unit_string</span><span class="p">,</span> <span class="n">calendar</span><span class="p">,</span>
                             <span class="n">only_use_cftime_datetimes</span><span class="o">=</span><span class="n">only_use_cftime_datetimes</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calendar</span>    <span class="o">=</span> <span class="n">calendar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_jd0</span>        <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">origin</span>      <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tzoffset</span>    <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">unit_string</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">units</span>       <span class="o">=</span> <span class="bp">None</span>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;x.__repr__() &lt;==&gt; repr(x)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">unit_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_string</span>
        <span class="k">if</span> <span class="n">unit_string</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">unit_string</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calendar</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;&lt;Utime: {}&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">num2date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return a datetime-like object given a time value.</span>

<span class="sd">    The units of the time value are described by the `!unit_string`</span>
<span class="sd">    and `!calendar` attributes.</span>
<span class="sd">    </span>
<span class="sd">    See `netCDF4.netcdftime.utime.num2date` for details.</span>
<span class="sd">    </span>
<span class="sd">    In addition to `netCDF4.netcdftime.utime.num2date`, this method</span>
<span class="sd">    handles units of months and years as defined by Udunits, ie. 1</span>
<span class="sd">    year = 365.242198781 days, 1 month = 365.242198781/12 days.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">units</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">units</span>
        <span class="n">unit_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit_string</span>

        <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;months&#39;</span><span class="p">):</span>
            <span class="c1"># Convert months to days</span>
            <span class="n">unit_string</span> <span class="o">=</span> <span class="n">unit_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">time_value</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="p">(</span><span class="n">time_value</span><span class="p">)</span><span class="o">*</span><span class="n">_month_length</span> <span class="c1">#365.242198781/12</span>
        <span class="k">elif</span> <span class="n">units</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;years&#39;</span><span class="p">,</span> <span class="s1">&#39;yr&#39;</span><span class="p">):</span>
            <span class="c1"># Convert years to days</span>
            <span class="n">unit_string</span> <span class="o">=</span> <span class="n">unit_string</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">units</span><span class="p">,</span> <span class="s1">&#39;days&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">time_value</span> <span class="o">=</span> <span class="n">numpy_array</span><span class="p">(</span><span class="n">time_value</span><span class="p">)</span><span class="o">*</span><span class="n">_year_length</span> <span class="c1">#365.242198781</span>

        <span class="n">u</span> <span class="o">=</span> <span class="n">cftime</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="n">unit_string</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">calendar</span><span class="p">)</span>        

        <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">time_value</span><span class="p">)</span>

    
<span class="c1">#    def origin_equals(self, other):</span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        </span>
<span class="c1">#        &#39;&#39;&#39;</span>
<span class="c1">#        if self is other:</span>
<span class="c1">#            return True</span>
<span class="c1">#        else:</span>
<span class="c1">#            return (self._jd0     == other._jd0     and</span>
<span class="c1">#                    self.calendar == other.calendar and</span>
<span class="c1">#                    self.tzoffset == other.tzoffset)</span>


<span class="c1">#--- End: class</span>
</pre></div>

          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2015, David Hassell.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>